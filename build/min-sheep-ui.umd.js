(function(b,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],l):(b=typeof globalThis<"u"?globalThis:b||self,l(b["min-sheep-ui"]={},b.Vue))})(this,function(b,l){"use strict";const M={type:{type:String,default:"secondary"},size:{type:String,default:"medium"},disabled:{type:Boolean,default:!1},block:{type:Boolean,default:!1}},X="",L=l.defineComponent({name:"SButton",props:M,setup(t,{slots:e}){const{type:d,size:a,disabled:n,block:r}=l.toRefs(t),u=r.value?"s-btn--block":"";return()=>l.createVNode("button",{disabled:n.value,class:`s-btn s-btn--${d.value} s-btn--${a.value} ${u}`},[e.default?e.default():"按钮"])}}),z={install(t){t.component(L.name,L)}};function V(t,e=0,d=[]){return e++,t.reduce((a,n)=>{const r={...n};r.level=e,d.length>0&&d[d.length-1].level>=e&&d.pop(),d.push(r);const u=d[d.length-2];if(u&&(r.parentId=u.id),r.children){const o=V(r.children,e,d);return delete r.children,a.concat(r,o)}else return r.isLeaf===void 0&&(r.isLeaf=!0),a.concat(r)},[])}function j(t,{getChildren:e}){return{toggleCheckNode:a=>{a.checked=!a.checked,e(a).forEach(o=>{o.checked=a.checked});const n=t.value.find(o=>o.id===a.parentId);if(!n)return;const r=e(n,!1),u=r.filter(o=>o.checked);u.length===r.length?n.checked=!0:u.length===0&&(n.checked=!1)}}}function $(t){const e=l.computed(()=>{let o=[];const f=[];for(const p of t.value)o.map(c=>c.id).includes(p.id)||(p.expanded!==!0&&(o=d(p)),f.push(p));return f}),d=(o,f=!0)=>{const p=[],c=t.value.findIndex(v=>v.id===o.id);for(let v=c+1;v<t.value.length&&o.level<t.value[v].level;v++)(f||o.level===t.value[v].level-1)&&p.push(t.value[v]);return p},a=(o,f=[])=>{const p=d(o,!1);return f.push(...p),p.forEach(c=>{c.expanded&&a(c,f)}),f};return{expandedTree:e,getChildren:d,getChildrenExpanded:a,getIndex:o=>o?t.value.findIndex(f=>f.id===o.id):-1,getNode:o=>t.value.find(f=>f.id===o.id),getParent:o=>t.value.find(f=>f.id===o.parentId)}}const C={dropPrev:"s-tree__node--drop-prev",dropNext:"s-tree__node--drop-next",dropInner:"s-tree__node--drop-inner"};function R(t,e,{getChildren:d,getParent:a}){const n=l.reactive({dropType:void 0,draggingNode:null,draggingTreeNode:null}),r=l.computed(()=>e.value.reduce((s,i)=>({...s,[i.id]:i}),{})),u=s=>{s==null||s.classList.remove(...Object.values(C))},o=(s,i)=>{var h;const g=(h=r.value[s])==null?void 0:h.parentId;return g===i?!0:g!==void 0?o(g,i):!1},f=()=>{n.dropType=void 0,n.draggingNode=null,n.draggingTreeNode=null},p=(s,i)=>{var g;s.stopPropagation(),n.draggingNode=s.target,n.draggingTreeNode=i,(g=s.dataTransfer)==null||g.setData("dragNodeId",i.id)},c=s=>{if(s.preventDefault(),s.stopPropagation(),!!n.draggingNode&&t){if(s.dataTransfer&&(s.dataTransfer.dropEffect="move"),!e)return;let i={};typeof t=="object"?i=t:t===!0&&(i={dropInner:!0});const{dropPrev:g,dropNext:h,dropInner:N}=i;let x;const y=g?N?.25:h?.45:1:-1,T=h?N?.75:g?.55:0:1,I=s.currentTarget,m=I==null?void 0:I.getBoundingClientRect(),B=s.clientY-((m==null?void 0:m.top)||0);if(B<((m==null?void 0:m.height)||0)*y?x="dropPrev":B>((m==null?void 0:m.height)||0)*T?x="dropNext":N?x="dropInner":x=void 0,x){const _=I==null?void 0:I.classList;_&&(_.contains(C[x])||(u(I),_.add(C[x])))}else u(I);n.dropType=x}},v=s=>{s.stopPropagation(),n.draggingNode&&u(s.currentTarget)},k=(s,i)=>{var h;if(s.preventDefault(),s.stopPropagation(),u(s.currentTarget),!n.draggingNode||!t)return;const g=(h=s.dataTransfer)==null?void 0:h.getData("dragNodeId");if(g){const N=o(i.id,g);if(g===i.id||N)return;n.dropType&&D(g,i),f()}};function D(s,i){const g=e.value.find(h=>h.id===s);if(g){let h;const N=d(g),x=a(g);if(n.dropType==="dropInner"){h={...g,parentId:i.id,level:i.level+1};const y=e.value.indexOf(i);e.value.splice(y+1,0,h),i.isLeaf=void 0;const T=e.value.indexOf(g);e.value.splice(T,1)}else if(n.dropType==="dropNext"){h={...g,parentId:i.parentId,level:i.level};const y=e.value.indexOf(i),T=d(i,!0).length;e.value.splice(y+T+1,0,h);const I=e.value.indexOf(g);e.value.splice(I,1)}else if(n.dropType==="dropPrev"){h={...g,parentId:i.parentId,level:i.level};const y=e.value.indexOf(i);e.value.splice(y,0,h);const T=e.value.indexOf(g);e.value.splice(T,1)}n.dropType="dropInner",N.forEach(y=>D(y.id,h)),x&&d(x).length===0&&(x.isLeaf=!0)}}return{onDragstart:p,onDragover:c,onDragleave:v,onDrop:k,onDragend:s=>{s.preventDefault(),s.stopPropagation(),f()}}}function H(t,{getNode:e,getIndex:d,getChildren:a},{emit:n}){const r=p=>{const c=e(p);c&&c.isLeaf===!1&&!c.childNodeCount&&(c.loading=!0,n("lazy-load",p,u))},u=p=>{const c=e(p.node);if(c){c.loading=!1;const v=l.ref(V(p.treeItems,c.level));o(c,v),f(c,v);const k=a(c);c.childNodeCount=k.length}},o=(p,c)=>{c.value.forEach(v=>{v.level-1===p.level&&!v.parentId&&(v.parentId=p.id)})},f=(p,c)=>{const v=d(p);v&&t.value.splice(v+1,0,...c.value)};return{lazyLoadNodes:r}}function q(t=8){const e="abcdefghijklmnopqrstuvwxyz0123456789";let d="";for(let a=0;a<t;a++)d+=e[parseInt((Math.random()*e.length).toString())];return d}function U(t,{getChildren:e,getIndex:d}){return{append:(r,u)=>{const o=e(r,!1),f=o[o.length-1];let p=d(r)+1;f&&(p=d(f)+1),r.expanded=!0,r.isLeaf=!1;const c=l.ref({...u,level:r.level+1,parentId:r.id,isLeaf:!0});c.value.id===void 0&&(c.value.id=q()),t.value.splice(p,0,c.value)},remove:r=>{const u=e(r).map(o=>o.id);t.value=t.value.filter(o=>o.id!==r.id&&!u.includes(o.id))}}}function G(t,e,d,a){const{lazyLoadNodes:n}=a;return{toggleNode:u=>{const o=t.value.find(f=>f.id===u.id);o&&(o.expanded=!o.expanded,o.expanded&&n(o))}}}function Y(t,e,d){const a=l.unref(t),n=l.ref(V(a)),r=$(n),u=[G,j,U],o=H(n,r,d),f=R(e.draggable,n,r);return{...u.reduce((c,v)=>({...c,...v(n,r,d,o)}),{}),...r,...f,treeData:n}}const O={data:{type:Object,required:!0},lineable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1},draggable:{type:[Boolean,Object],default:!1}},A={...O,treeNode:{type:Object,required:!0}},S=32,E=24,F=l.defineComponent({name:"STreeNode",props:A,setup(t,{slots:e}){const{lineable:d,checkable:a,treeNode:n,operable:r,draggable:u}=l.toRefs(t),{toggleCheckNode:o,getChildrenExpanded:f,append:p,remove:c,onDragend:v,onDragleave:k,onDragover:D,onDragstart:w,onDrop:s}=l.inject("TREE_UTILS"),i=l.ref(!1),g=()=>{i.value?i.value=!1:i.value=!0};let h={};return u.value&&(h={draggable:!0,onDragend:N=>v(N),onDragleave:N=>k(N),onDragover:N=>D(N),onDragstart:N=>w(N,n.value),onDrop:N=>s(N,n.value)}),()=>{var N,x,y;return l.createVNode("div",{class:"s-tree__node hover:bg-slate-300 relative leading-8",style:{paddingLeft:`${E*(n.value.level-1)}px`},onMouseenter:g,onMouseleave:g},[!n.value.isLeaf&&n.value.expanded&&d.value&&l.createVNode("span",{class:"s-tree-node__vline absolute w-px bg-slate-300",style:{height:`${S*f(n.value).length}px`,left:`${E*(n.value.level-1)+9}px`,top:`${S}px`}},null),l.createVNode("div",l.mergeProps({class:"s-tree__node--content"},h),[n.value.isLeaf?l.createVNode("span",{style:{display:"inline-block",width:"18px"}},null):(N=e.icon)==null?void 0:N.call(e),a.value&&l.withDirectives(l.createVNode("input",{type:"checkbox","onUpdate:modelValue":T=>n.value.checked=T,onClick:()=>{o(n.value)}},null),[[l.vModelCheckbox,n.value.checked]]),(x=e.content)==null?void 0:x.call(e),r.value&&i.value&&l.createVNode("span",{class:"inline-flex ml-1"},[l.createVNode("svg",{onClick:()=>{p(n.value,{label:"新节点"})},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer"},[l.createVNode("path",{d:"M590.769231 571.076923h324.923077c15.753846 0 29.538462-13.784615 29.538461-29.538461v-59.076924c0-15.753846-13.784615-29.538462-29.538461-29.538461H590.769231c-11.815385 0-19.692308-7.876923-19.692308-19.692308V108.307692c0-15.753846-13.784615-29.538462-29.538461-29.538461h-59.076924c-15.753846 0-29.538462 13.784615-29.538461 29.538461V433.230769c0 11.815385-7.876923 19.692308-19.692308 19.692308H108.307692c-15.753846 0-29.538462 13.784615-29.538461 29.538461v59.076924c0 15.753846 13.784615 29.538462 29.538461 29.538461H433.230769c11.815385 0 19.692308 7.876923 19.692308 19.692308v324.923077c0 15.753846 13.784615 29.538462 29.538461 29.538461h59.076924c15.753846 0 29.538462-13.784615 29.538461-29.538461V590.769231c0-11.815385 7.876923-19.692308 19.692308-19.692308z"},null)]),l.createVNode("svg",{onClick:()=>{c(n.value)},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer ml-1"},[l.createVNode("path",{d:"M610.461538 500.184615l256-257.96923c11.815385-11.815385 11.815385-29.538462 0-41.353847l-39.384615-41.353846c-11.815385-11.815385-29.538462-11.815385-41.353846 0L527.753846 417.476923c-7.876923 7.876923-19.692308 7.876923-27.569231 0L242.215385 157.538462c-11.815385-11.815385-29.538462-11.815385-41.353847 0l-41.353846 41.353846c-11.815385 11.815385-11.815385 29.538462 0 41.353846l257.969231 257.969231c7.876923 7.876923 7.876923 19.692308 0 27.56923L157.538462 785.723077c-11.815385 11.815385-11.815385 29.538462 0 41.353846l41.353846 41.353846c11.815385 11.815385 29.538462 11.815385 41.353846 0L498.215385 610.461538c7.876923-7.876923 19.692308-7.876923 27.56923 0l257.969231 257.969231c11.815385 11.815385 29.538462 11.815385 41.353846 0L866.461538 827.076923c11.815385-11.815385 11.815385-29.538462 0-41.353846L610.461538 527.753846c-7.876923-7.876923-7.876923-19.692308 0-27.569231z"},null)])]),n.value.loading&&((y=e.loading)==null?void 0:y.call(e))])])}}}),J=(t,{emit:e})=>l.createVNode("svg",{style:{width:"18px",height:"18px",display:"inline-block",transform:t.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",onClick:()=>e("onClick")},[l.createVNode("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)]),Z="",P=l.defineComponent({name:"STree",props:O,emits:["lazy-load"],setup(t,e){const{data:d}=l.toRefs(t),{slots:a}=e,n=Y(d,t,e);return l.provide("TREE_UTILS",n),()=>{var r;return l.createVNode("div",{class:"s-tree"},[(r=n.expandedTree)==null?void 0:r.value.map(u=>l.createVNode(F,l.mergeProps(t,{treeNode:u}),{content:()=>a.content?a.content(u):u.label,icon:()=>a.icon?a.icon({nodeData:u,toggleNode:n.toggleNode}):l.createVNode(J,{expanded:!!u.expanded,onClick:()=>n.toggleNode(u)},null),loading:()=>a.loading?a.loading({nodeData:n}):l.createVNode("span",{class:"ml-1"},[l.createTextVNode("loading...")])}))])}}}),K={install(t){t.component(P.name,P)}},ee="",Q=[z,K],W={version:"0.0.1",install(t){Q.forEach(e=>t.use(e))}};b.Button=L,b.Tree=P,b.default=W,Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
