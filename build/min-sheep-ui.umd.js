(function(b,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(b=typeof globalThis<"u"?globalThis:b||self,e(b["min-sheep-ui"]={},b.Vue))})(this,function(b,e){"use strict";const H={type:{type:String,default:"secondary"},size:{type:String,default:"medium"},disabled:{type:Boolean,default:!1},block:{type:Boolean,default:!1}},ce="",C=e.defineComponent({name:"SButton",props:H,setup(n,{slots:t}){const{type:l,size:r,disabled:o,block:a}=e.toRefs(n),d=a.value?"s-btn--block":"";return()=>e.createVNode("button",{disabled:o.value,class:`s-btn s-btn--${l.value} s-btn--${r.value} ${d}`},[t.default?t.default():"按钮"])}}),$={install(n){n.component(C.name,C)}};function L(n,t=0,l=[]){return t++,n.reduce((r,o)=>{const a={...o};a.level=t,l.length>0&&l[l.length-1].level>=t&&l.pop(),l.push(a);const d=l[l.length-2];if(d&&(a.parentId=d.id),a.children){const c=L(a.children,t,l);return delete a.children,r.concat(a,c)}else return a.isLeaf===void 0&&(a.isLeaf=!0),r.concat(a)},[])}function R(n,{getChildren:t}){return{toggleCheckNode:r=>{r.checked=!r.checked,t(r).forEach(c=>{c.checked=r.checked});const o=n.value.find(c=>c.id===r.parentId);if(!o)return;const a=t(o,!1),d=a.filter(c=>c.checked);d.length===a.length?o.checked=!0:d.length===0&&(o.checked=!1)}}}function A(n){const t=e.computed(()=>{let c=[];const s=[];for(const u of n.value)c.map(i=>i.id).includes(u.id)||(u.expanded!==!0&&(c=l(u)),s.push(u));return s}),l=(c,s=!0)=>{const u=[],i=n.value.findIndex(h=>h.id===c.id);for(let h=i+1;h<n.value.length&&c.level<n.value[h].level;h++)(s||c.level===n.value[h].level-1)&&u.push(n.value[h]);return u},r=(c,s=[])=>{const u=l(c,!1);return s.push(...u),u.forEach(i=>{i.expanded&&r(i,s)}),s};return{expandedTree:t,getChildren:l,getChildrenExpanded:r,getIndex:c=>c?n.value.findIndex(s=>s.id===c.id):-1,getNode:c=>n.value.find(s=>s.id===c.id),getParent:c=>n.value.find(s=>s.id===c.parentId)}}const D={dropPrev:"s-tree__node--drop-prev",dropNext:"s-tree__node--drop-next",dropInner:"s-tree__node--drop-inner"};function q(n,t,{getChildren:l,getParent:r}){const o=e.reactive({dropType:void 0,draggingNode:null,draggingTreeNode:null}),a=e.computed(()=>t.value.reduce((p,f)=>({...p,[f.id]:f}),{})),d=p=>{p==null||p.classList.remove(...Object.values(D))},c=(p,f)=>{var v;const g=(v=a.value[p])==null?void 0:v.parentId;return g===f?!0:g!==void 0?c(g,f):!1},s=()=>{o.dropType=void 0,o.draggingNode=null,o.draggingTreeNode=null},u=(p,f)=>{var g;p.stopPropagation(),o.draggingNode=p.target,o.draggingTreeNode=f,(g=p.dataTransfer)==null||g.setData("dragNodeId",f.id)},i=p=>{if(p.preventDefault(),p.stopPropagation(),!!o.draggingNode&&n){if(p.dataTransfer&&(p.dataTransfer.dropEffect="move"),!t)return;let f={};typeof n=="object"?f=n:n===!0&&(f={dropInner:!0});const{dropPrev:g,dropNext:v,dropInner:N}=f;let m;const y=g?N?.25:v?.45:1:-1,V=v?N?.75:g?.55:0:1,P=p.currentTarget,T=P==null?void 0:P.getBoundingClientRect(),j=p.clientY-((T==null?void 0:T.top)||0);if(j<((T==null?void 0:T.height)||0)*y?m="dropPrev":j>((T==null?void 0:T.height)||0)*V?m="dropNext":N?m="dropInner":m=void 0,m){const E=P==null?void 0:P.classList;E&&(E.contains(D[m])||(d(P),E.add(D[m])))}else d(P);o.dropType=m}},h=p=>{p.stopPropagation(),o.draggingNode&&d(p.currentTarget)},x=(p,f)=>{var v;if(p.preventDefault(),p.stopPropagation(),d(p.currentTarget),!o.draggingNode||!n)return;const g=(v=p.dataTransfer)==null?void 0:v.getData("dragNodeId");if(g){const N=c(f.id,g);if(g===f.id||N)return;o.dropType&&I(g,f),s()}};function I(p,f){const g=t.value.find(v=>v.id===p);if(g){let v;const N=l(g),m=r(g);if(o.dropType==="dropInner"){v={...g,parentId:f.id,level:f.level+1};const y=t.value.indexOf(f);t.value.splice(y+1,0,v),f.isLeaf=void 0;const V=t.value.indexOf(g);t.value.splice(V,1)}else if(o.dropType==="dropNext"){v={...g,parentId:f.parentId,level:f.level};const y=t.value.indexOf(f),V=l(f,!0).length;t.value.splice(y+V+1,0,v);const P=t.value.indexOf(g);t.value.splice(P,1)}else if(o.dropType==="dropPrev"){v={...g,parentId:f.parentId,level:f.level};const y=t.value.indexOf(f);t.value.splice(y,0,v);const V=t.value.indexOf(g);t.value.splice(V,1)}o.dropType="dropInner",N.forEach(y=>I(y.id,v)),m&&l(m).length===0&&(m.isLeaf=!0)}}return{onDragstart:u,onDragover:i,onDragleave:h,onDrop:x,onDragend:p=>{p.preventDefault(),p.stopPropagation(),s()}}}function U(n,{getNode:t,getIndex:l,getChildren:r},{emit:o}){const a=u=>{const i=t(u);i&&i.isLeaf===!1&&!i.childNodeCount&&(i.loading=!0,o("lazy-load",u,d))},d=u=>{const i=t(u.node);if(i){i.loading=!1;const h=e.ref(L(u.treeItems,i.level));c(i,h),s(i,h);const x=r(i);i.childNodeCount=x.length}},c=(u,i)=>{i.value.forEach(h=>{h.level-1===u.level&&!h.parentId&&(h.parentId=u.id)})},s=(u,i)=>{const h=l(u);h&&n.value.splice(h+1,0,...i.value)};return{lazyLoadNodes:a}}function Y(n=8){const t="abcdefghijklmnopqrstuvwxyz0123456789";let l="";for(let r=0;r<n;r++)l+=t[parseInt((Math.random()*t.length).toString())];return l}function G(n,{getChildren:t,getIndex:l}){return{append:(a,d)=>{const c=t(a,!1),s=c[c.length-1];let u=l(a)+1;s&&(u=l(s)+1),a.expanded=!0,a.isLeaf=!1;const i=e.ref({...d,level:a.level+1,parentId:a.id,isLeaf:!0});i.value.id===void 0&&(i.value.id=Y()),n.value.splice(u,0,i.value)},remove:a=>{const d=t(a).map(c=>c.id);n.value=n.value.filter(c=>c.id!==a.id&&!d.includes(c.id))}}}function F(n,t,l,r){const{lazyLoadNodes:o}=r;return{toggleNode:d=>{const c=n.value.find(s=>s.id===d.id);c&&(c.expanded=!c.expanded,c.expanded&&o(c))}}}function J(n,t,l){const r=e.unref(n),o=e.ref(L(r)),a=A(o),d=[F,R,G],c=U(o,a,l),s=q(t.draggable,o,a);return{...d.reduce((i,h)=>({...i,...h(o,a,l,c)}),{}),...a,...s,treeData:o}}const w={data:{type:Object,required:!0},lineable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1},draggable:{type:[Boolean,Object],default:!1},height:{type:Number},itemHeight:{type:Number,default:30}},K={...w,treeNode:{type:Object,required:!0}},O=32,B=24,Q=e.defineComponent({name:"STreeNode",props:K,setup(n,{slots:t}){const{lineable:l,checkable:r,treeNode:o,operable:a,draggable:d}=e.toRefs(n),{toggleCheckNode:c,getChildrenExpanded:s,append:u,remove:i,onDragend:h,onDragleave:x,onDragover:I,onDragstart:k,onDrop:p}=e.inject("TREE_UTILS"),f=e.ref(!1),g=()=>{f.value?f.value=!1:f.value=!0};let v={};return d.value&&(v={draggable:!0,onDragend:N=>h(N),onDragleave:N=>x(N),onDragover:N=>I(N),onDragstart:N=>k(N,o.value),onDrop:N=>p(N,o.value)}),()=>{var N,m,y;return e.createVNode("div",{class:"s-tree__node hover:bg-slate-300 relative leading-8",style:{paddingLeft:`${B*(o.value.level-1)}px`},onMouseenter:g,onMouseleave:g},[!o.value.isLeaf&&o.value.expanded&&l.value&&e.createVNode("span",{class:"s-tree-node__vline absolute w-px bg-slate-300",style:{height:`${O*s(o.value).length}px`,left:`${B*(o.value.level-1)+9}px`,top:`${O}px`}},null),e.createVNode("div",e.mergeProps({class:"s-tree__node--content"},v),[o.value.isLeaf?e.createVNode("span",{style:{display:"inline-block",width:"18px"}},null):(N=t.icon)==null?void 0:N.call(t),r.value&&e.withDirectives(e.createVNode("input",{type:"checkbox","onUpdate:modelValue":V=>o.value.checked=V,onClick:()=>{c(o.value)}},null),[[e.vModelCheckbox,o.value.checked]]),(m=t.content)==null?void 0:m.call(t),a.value&&f.value&&e.createVNode("span",{class:"inline-flex ml-1"},[e.createVNode("svg",{onClick:()=>{u(o.value,{label:"新节点"})},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer"},[e.createVNode("path",{d:"M590.769231 571.076923h324.923077c15.753846 0 29.538462-13.784615 29.538461-29.538461v-59.076924c0-15.753846-13.784615-29.538462-29.538461-29.538461H590.769231c-11.815385 0-19.692308-7.876923-19.692308-19.692308V108.307692c0-15.753846-13.784615-29.538462-29.538461-29.538461h-59.076924c-15.753846 0-29.538462 13.784615-29.538461 29.538461V433.230769c0 11.815385-7.876923 19.692308-19.692308 19.692308H108.307692c-15.753846 0-29.538462 13.784615-29.538461 29.538461v59.076924c0 15.753846 13.784615 29.538462 29.538461 29.538461H433.230769c11.815385 0 19.692308 7.876923 19.692308 19.692308v324.923077c0 15.753846 13.784615 29.538462 29.538461 29.538461h59.076924c15.753846 0 29.538462-13.784615 29.538461-29.538461V590.769231c0-11.815385 7.876923-19.692308 19.692308-19.692308z"},null)]),e.createVNode("svg",{onClick:()=>{i(o.value)},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer ml-1"},[e.createVNode("path",{d:"M610.461538 500.184615l256-257.96923c11.815385-11.815385 11.815385-29.538462 0-41.353847l-39.384615-41.353846c-11.815385-11.815385-29.538462-11.815385-41.353846 0L527.753846 417.476923c-7.876923 7.876923-19.692308 7.876923-27.569231 0L242.215385 157.538462c-11.815385-11.815385-29.538462-11.815385-41.353847 0l-41.353846 41.353846c-11.815385 11.815385-11.815385 29.538462 0 41.353846l257.969231 257.969231c7.876923 7.876923 7.876923 19.692308 0 27.56923L157.538462 785.723077c-11.815385 11.815385-11.815385 29.538462 0 41.353846l41.353846 41.353846c11.815385 11.815385 29.538462 11.815385 41.353846 0L498.215385 610.461538c7.876923-7.876923 19.692308-7.876923 27.56923 0l257.969231 257.969231c11.815385 11.815385 29.538462 11.815385 41.353846 0L866.461538 827.076923c11.815385-11.815385 11.815385-29.538462 0-41.353846L610.461538 527.753846c-7.876923-7.876923-7.876923-19.692308 0-27.569231z"},null)])]),o.value.loading&&((y=t.loading)==null?void 0:y.call(t))])])}}}),W=(n,{emit:t})=>e.createVNode("svg",{style:{width:"18px",height:"18px",display:"inline-block",transform:n.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",onClick:()=>t("onClick")},[e.createVNode("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)]),de="",X={data:{type:Array,default:[]},itemHeight:{type:Number,default:22},component:{type:String,default:"div"}},se="",Z=e.defineComponent({name:"SVirtualList",props:X,setup(n,{slots:t}){const{data:l,itemHeight:r,component:o}=e.toRefs(n),a=e.ref(),d=e.ref(0),c=e.ref(0),s=e.ref(0),u=e.computed(()=>Math.ceil(d.value/r.value)),i=e.computed(()=>l.value.slice(s.value,Math.min(s.value+u.value,l.value.length)));e.onMounted(()=>{var x;d.value=(x=a.value)==null?void 0:x.clientHeight});const h=x=>{const{scrollTop:I}=x.target;s.value=Math.floor(I/r.value),c.value=I-I%r.value};return()=>e.createVNode(o.value,{class:"s-virtual-list__container",ref:a,onScroll:h},{default:()=>[e.createVNode("div",{class:"s-virtual-list__blank",style:{height:`${l.value.length*r.value}px`}},null),e.createVNode("div",{class:"s-virtual-list",style:{transform:`translate3d(0, ${c.value}px, 0)`}},[i.value.map((x,I)=>{var k;return(k=t.default)==null?void 0:k.call(t,{item:x,index:I})})])]})}}),S=e.defineComponent({name:"STree",props:w,emits:["lazy-load"],setup(n,t){const{data:l,height:r,itemHeight:o}=e.toRefs(n),{slots:a}=t,d=J(l,n,t);return e.provide("TREE_UTILS",d),()=>{const c=s=>e.createVNode(Q,e.mergeProps(n,{treeNode:s}),{content:()=>a.content?a.content(s):s.label,icon:()=>a.icon?a.icon({nodeData:s,toggleNode:d.toggleNode}):e.createVNode(W,{expanded:!!s.expanded,onClick:()=>d.toggleNode(s)},null),loading:()=>a.loading?a.loading({nodeData:d}):e.createVNode("span",{class:"ml-1"},[e.createTextVNode("loading...")])});return e.createVNode("div",{class:"s-tree"},[r!=null&&r.value?e.createVNode("div",{style:{height:`${r.value}px`}},[e.createVNode(Z,{data:d.expandedTree.value,itemHeight:o.value},{default:({item:s})=>c(s)})]):d.expandedTree.value.map(s=>c(s))])}}}),ee={install(n){n.component(S.name,S)}},z={total:{type:Number,default:0},pageSize:{type:Number,default:10},pagerCount:{type:Number,default:7},modelValue:{type:Number,default:1}},ie="";function te(n=1){const t=e.ref(n),l=d=>{t.value=d},r=d=>{t.value+=d};return{pageIndex:t,setPageIndex:l,jumpPage:r,prevPage:()=>r(-1),nextPage:()=>r(1)}}const ne=(n,t,l)=>{const r=Array.from(Array(n).keys());if(n<=l)return r.slice(2,n);{const o=Math.ceil(l/2);return t<=o?r.slice(2,l):t>=n-o+1?r.slice(n-l+2,n):r.slice(t-o+2,t+o-1)}},oe=z,M=e.defineComponent({name:"SPager",props:oe,setup(n){const{total:t,pageSize:l,pagerCount:r}=e.toRefs(n),o=e.computed(()=>Math.ceil(t.value/l.value)),{pageIndex:a,setPageIndex:d,jumpPage:c,prevPage:s,nextPage:u}=te(),i=e.computed(()=>ne(o.value,a.value,r.value));return{totalPage:o,pageIndex:a,setPageIndex:d,jumpPage:c,prevPage:s,nextPage:u,centerPages:i}},render(){const{pagerCount:n,totalPage:t,pageIndex:l,setPageIndex:r,jumpPage:o,centerPages:a}=this;return e.createVNode("ul",{class:"s-pager"},[e.createVNode("li",{onClick:()=>r(1),class:{current:l===1}},[e.createTextVNode("1")]),t>n&&l>Math.ceil(n/2)&&e.createVNode("li",{class:"more left",onClick:()=>o(-5)},[e.createTextVNode("...")]),a.map(d=>e.createVNode("li",{onClick:()=>r(d),class:{current:l===d}},[d])),t>n&&l<t-Math.ceil(n/2)+1&&e.createVNode("li",{class:"more right",onClick:()=>o(5)},[e.createTextVNode("...")]),t>1&&e.createVNode("li",{onClick:()=>r(t),class:{current:l===t}},[t])])}}),_=e.defineComponent({name:"SPagination",props:z,emits:["update:modelValue"],setup(n,{emit:t}){const l=e.ref(),r=e.computed(()=>l.value?l.value.pageIndex<2:!0),o=e.computed(()=>l.value?l.value.pageIndex>l.value.totalPage-1:!0);return e.onMounted(()=>{e.watch(()=>l.value.pageIndex,a=>{t("update:modelValue",a)}),e.watch(()=>n.modelValue,a=>{l.value.pageIndex=a})}),()=>e.createVNode("div",{class:"s-pagination"},[e.createVNode("button",{disabled:r.value,onClick:()=>l.value.prevPage()},[e.createTextVNode("上一页")]),e.createVNode(M,e.mergeProps(n,{ref:l}),null),e.createVNode("button",{disabled:o.value,onClick:()=>l.value.nextPage()},[e.createTextVNode("下一页")])])}}),le={install(n){n.component(_.name,_),n.component(M.name,M)}},ue="",ae=[$,ee,le],re={version:"0.0.1",install(n){ae.forEach(t=>n.use(t))}};b.Button=C,b.Pagination=_,b.Tree=S,b.default=re,Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
