(function(T,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(T=typeof globalThis<"u"?globalThis:T||self,t(T["min-sheep-ui"]={},T.Vue))})(this,function(T,t){"use strict";const B={type:{type:String,default:"secondary"},size:{type:String,default:"medium"},disabled:{type:Boolean,default:!1},block:{type:Boolean,default:!1}},ee="",D=t.defineComponent({name:"SButton",props:B,setup(l,{slots:e}){const{type:d,size:c,disabled:n,block:r}=t.toRefs(l),s=r.value?"s-btn--block":"";return()=>t.createVNode("button",{disabled:n.value,class:`s-btn s-btn--${d.value} s-btn--${c.value} ${s}`},[e.default?e.default():"按钮"])}}),z={install(l){l.component(D.name,D)}};function C(l,e=0,d=[]){return e++,l.reduce((c,n)=>{const r={...n};r.level=e,d.length>0&&d[d.length-1].level>=e&&d.pop(),d.push(r);const s=d[d.length-2];if(s&&(r.parentId=s.id),r.children){const o=C(r.children,e,d);return delete r.children,c.concat(r,o)}else return r.isLeaf===void 0&&(r.isLeaf=!0),c.concat(r)},[])}function H(l,{getChildren:e}){return{toggleCheckNode:c=>{c.checked=!c.checked,e(c).forEach(o=>{o.checked=c.checked});const n=l.value.find(o=>o.id===c.parentId);if(!n)return;const r=e(n,!1),s=r.filter(o=>o.checked);s.length===r.length?n.checked=!0:s.length===0&&(n.checked=!1)}}}function $(l){const e=t.computed(()=>{let o=[];const a=[];for(const f of l.value)o.map(i=>i.id).includes(f.id)||(f.expanded!==!0&&(o=d(f)),a.push(f));return a}),d=(o,a=!0)=>{const f=[],i=l.value.findIndex(v=>v.id===o.id);for(let v=i+1;v<l.value.length&&o.level<l.value[v].level;v++)(a||o.level===l.value[v].level-1)&&f.push(l.value[v]);return f},c=(o,a=[])=>{const f=d(o,!1);return a.push(...f),f.forEach(i=>{i.expanded&&c(i,a)}),a};return{expandedTree:e,getChildren:d,getChildrenExpanded:c,getIndex:o=>o?l.value.findIndex(a=>a.id===o.id):-1,getNode:o=>l.value.find(a=>a.id===o.id),getParent:o=>l.value.find(a=>a.id===o.parentId)}}const P={dropPrev:"s-tree__node--drop-prev",dropNext:"s-tree__node--drop-next",dropInner:"s-tree__node--drop-inner"};function j(l,e,{getChildren:d,getParent:c}){const n=t.reactive({dropType:void 0,draggingNode:null,draggingTreeNode:null}),r=t.computed(()=>e.value.reduce((u,p)=>({...u,[p.id]:p}),{})),s=u=>{u==null||u.classList.remove(...Object.values(P))},o=(u,p)=>{var h;const g=(h=r.value[u])==null?void 0:h.parentId;return g===p?!0:g!==void 0?o(g,p):!1},a=()=>{n.dropType=void 0,n.draggingNode=null,n.draggingTreeNode=null},f=(u,p)=>{var g;u.stopPropagation(),n.draggingNode=u.target,n.draggingTreeNode=p,(g=u.dataTransfer)==null||g.setData("dragNodeId",p.id)},i=u=>{if(u.preventDefault(),u.stopPropagation(),!!n.draggingNode&&l){if(u.dataTransfer&&(u.dataTransfer.dropEffect="move"),!e)return;let p={};typeof l=="object"?p=l:l===!0&&(p={dropInner:!0});const{dropPrev:g,dropNext:h,dropInner:N}=p;let x;const y=g?N?.25:h?.45:1:-1,k=h?N?.75:g?.55:0:1,I=u.currentTarget,V=I==null?void 0:I.getBoundingClientRect(),w=u.clientY-((V==null?void 0:V.top)||0);if(w<((V==null?void 0:V.height)||0)*y?x="dropPrev":w>((V==null?void 0:V.height)||0)*k?x="dropNext":N?x="dropInner":x=void 0,x){const S=I==null?void 0:I.classList;S&&(S.contains(P[x])||(s(I),S.add(P[x])))}else s(I);n.dropType=x}},v=u=>{u.stopPropagation(),n.draggingNode&&s(u.currentTarget)},m=(u,p)=>{var h;if(u.preventDefault(),u.stopPropagation(),s(u.currentTarget),!n.draggingNode||!l)return;const g=(h=u.dataTransfer)==null?void 0:h.getData("dragNodeId");if(g){const N=o(p.id,g);if(g===p.id||N)return;n.dropType&&b(g,p),a()}};function b(u,p){const g=e.value.find(h=>h.id===u);if(g){let h;const N=d(g),x=c(g);if(n.dropType==="dropInner"){h={...g,parentId:p.id,level:p.level+1};const y=e.value.indexOf(p);e.value.splice(y+1,0,h),p.isLeaf=void 0;const k=e.value.indexOf(g);e.value.splice(k,1)}else if(n.dropType==="dropNext"){h={...g,parentId:p.parentId,level:p.level};const y=e.value.indexOf(p),k=d(p,!0).length;e.value.splice(y+k+1,0,h);const I=e.value.indexOf(g);e.value.splice(I,1)}else if(n.dropType==="dropPrev"){h={...g,parentId:p.parentId,level:p.level};const y=e.value.indexOf(p);e.value.splice(y,0,h);const k=e.value.indexOf(g);e.value.splice(k,1)}n.dropType="dropInner",N.forEach(y=>b(y.id,h)),x&&d(x).length===0&&(x.isLeaf=!0)}}return{onDragstart:f,onDragover:i,onDragleave:v,onDrop:m,onDragend:u=>{u.preventDefault(),u.stopPropagation(),a()}}}function R(l,{getNode:e,getIndex:d,getChildren:c},{emit:n}){const r=f=>{const i=e(f);i&&i.isLeaf===!1&&!i.childNodeCount&&(i.loading=!0,n("lazy-load",f,s))},s=f=>{const i=e(f.node);if(i){i.loading=!1;const v=t.ref(C(f.treeItems,i.level));o(i,v),a(i,v);const m=c(i);i.childNodeCount=m.length}},o=(f,i)=>{i.value.forEach(v=>{v.level-1===f.level&&!v.parentId&&(v.parentId=f.id)})},a=(f,i)=>{const v=d(f);v&&l.value.splice(v+1,0,...i.value)};return{lazyLoadNodes:r}}function q(l=8){const e="abcdefghijklmnopqrstuvwxyz0123456789";let d="";for(let c=0;c<l;c++)d+=e[parseInt((Math.random()*e.length).toString())];return d}function U(l,{getChildren:e,getIndex:d}){return{append:(r,s)=>{const o=e(r,!1),a=o[o.length-1];let f=d(r)+1;a&&(f=d(a)+1),r.expanded=!0,r.isLeaf=!1;const i=t.ref({...s,level:r.level+1,parentId:r.id,isLeaf:!0});i.value.id===void 0&&(i.value.id=q()),l.value.splice(f,0,i.value)},remove:r=>{const s=e(r).map(o=>o.id);l.value=l.value.filter(o=>o.id!==r.id&&!s.includes(o.id))}}}function Y(l,e,d,c){const{lazyLoadNodes:n}=c;return{toggleNode:s=>{const o=l.value.find(a=>a.id===s.id);o&&(o.expanded=!o.expanded,o.expanded&&n(o))}}}function A(l,e,d){const c=t.unref(l),n=t.ref(C(c)),r=$(n),s=[Y,H,U],o=R(n,r,d),a=j(e.draggable,n,r);return{...s.reduce((i,v)=>({...i,...v(n,r,d,o)}),{}),...r,...a,treeData:n}}const E={data:{type:Object,required:!0},lineable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1},draggable:{type:[Boolean,Object],default:!1},height:{type:Number},itemHeight:{type:Number,default:30}},G={...E,treeNode:{type:Object,required:!0}},M=32,O=24,F=t.defineComponent({name:"STreeNode",props:G,setup(l,{slots:e}){const{lineable:d,checkable:c,treeNode:n,operable:r,draggable:s}=t.toRefs(l),{toggleCheckNode:o,getChildrenExpanded:a,append:f,remove:i,onDragend:v,onDragleave:m,onDragover:b,onDragstart:L,onDrop:u}=t.inject("TREE_UTILS"),p=t.ref(!1),g=()=>{p.value?p.value=!1:p.value=!0};let h={};return s.value&&(h={draggable:!0,onDragend:N=>v(N),onDragleave:N=>m(N),onDragover:N=>b(N),onDragstart:N=>L(N,n.value),onDrop:N=>u(N,n.value)}),()=>{var N,x,y;return t.createVNode("div",{class:"s-tree__node hover:bg-slate-300 relative leading-8",style:{paddingLeft:`${O*(n.value.level-1)}px`},onMouseenter:g,onMouseleave:g},[!n.value.isLeaf&&n.value.expanded&&d.value&&t.createVNode("span",{class:"s-tree-node__vline absolute w-px bg-slate-300",style:{height:`${M*a(n.value).length}px`,left:`${O*(n.value.level-1)+9}px`,top:`${M}px`}},null),t.createVNode("div",t.mergeProps({class:"s-tree__node--content"},h),[n.value.isLeaf?t.createVNode("span",{style:{display:"inline-block",width:"18px"}},null):(N=e.icon)==null?void 0:N.call(e),c.value&&t.withDirectives(t.createVNode("input",{type:"checkbox","onUpdate:modelValue":k=>n.value.checked=k,onClick:()=>{o(n.value)}},null),[[t.vModelCheckbox,n.value.checked]]),(x=e.content)==null?void 0:x.call(e),r.value&&p.value&&t.createVNode("span",{class:"inline-flex ml-1"},[t.createVNode("svg",{onClick:()=>{f(n.value,{label:"新节点"})},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer"},[t.createVNode("path",{d:"M590.769231 571.076923h324.923077c15.753846 0 29.538462-13.784615 29.538461-29.538461v-59.076924c0-15.753846-13.784615-29.538462-29.538461-29.538461H590.769231c-11.815385 0-19.692308-7.876923-19.692308-19.692308V108.307692c0-15.753846-13.784615-29.538462-29.538461-29.538461h-59.076924c-15.753846 0-29.538462 13.784615-29.538461 29.538461V433.230769c0 11.815385-7.876923 19.692308-19.692308 19.692308H108.307692c-15.753846 0-29.538462 13.784615-29.538461 29.538461v59.076924c0 15.753846 13.784615 29.538462 29.538461 29.538461H433.230769c11.815385 0 19.692308 7.876923 19.692308 19.692308v324.923077c0 15.753846 13.784615 29.538462 29.538461 29.538461h59.076924c15.753846 0 29.538462-13.784615 29.538461-29.538461V590.769231c0-11.815385 7.876923-19.692308 19.692308-19.692308z"},null)]),t.createVNode("svg",{onClick:()=>{i(n.value)},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer ml-1"},[t.createVNode("path",{d:"M610.461538 500.184615l256-257.96923c11.815385-11.815385 11.815385-29.538462 0-41.353847l-39.384615-41.353846c-11.815385-11.815385-29.538462-11.815385-41.353846 0L527.753846 417.476923c-7.876923 7.876923-19.692308 7.876923-27.569231 0L242.215385 157.538462c-11.815385-11.815385-29.538462-11.815385-41.353847 0l-41.353846 41.353846c-11.815385 11.815385-11.815385 29.538462 0 41.353846l257.969231 257.969231c7.876923 7.876923 7.876923 19.692308 0 27.56923L157.538462 785.723077c-11.815385 11.815385-11.815385 29.538462 0 41.353846l41.353846 41.353846c11.815385 11.815385 29.538462 11.815385 41.353846 0L498.215385 610.461538c7.876923-7.876923 19.692308-7.876923 27.56923 0l257.969231 257.969231c11.815385 11.815385 29.538462 11.815385 41.353846 0L866.461538 827.076923c11.815385-11.815385 11.815385-29.538462 0-41.353846L610.461538 527.753846c-7.876923-7.876923-7.876923-19.692308 0-27.569231z"},null)])]),n.value.loading&&((y=e.loading)==null?void 0:y.call(e))])])}}}),J=(l,{emit:e})=>t.createVNode("svg",{style:{width:"18px",height:"18px",display:"inline-block",transform:l.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",onClick:()=>e("onClick")},[t.createVNode("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)]),te="",K={data:{type:Array,default:[]},itemHeight:{type:Number,default:22},component:{type:String,default:"div"}},ne="",Q=t.defineComponent({name:"SVirtualList",props:K,setup(l,{slots:e}){const{data:d,itemHeight:c,component:n}=t.toRefs(l),r=t.ref(),s=t.ref(0),o=t.ref(0),a=t.ref(0),f=t.computed(()=>Math.ceil(s.value/c.value)),i=t.computed(()=>d.value.slice(a.value,Math.min(a.value+f.value,d.value.length)));t.onMounted(()=>{var m;s.value=(m=r.value)==null?void 0:m.clientHeight});const v=m=>{const{scrollTop:b}=m.target;a.value=Math.floor(b/c.value),o.value=b-b%c.value};return()=>t.createVNode(n.value,{class:"s-virtual-list__container",ref:r,onScroll:v},{default:()=>[t.createVNode("div",{class:"s-virtual-list__blank",style:{height:`${d.value.length*c.value}px`}},null),t.createVNode("div",{class:"s-virtual-list",style:{transform:`translate3d(0, ${o.value}px, 0)`}},[i.value.map((m,b)=>{var L;return(L=e.default)==null?void 0:L.call(e,{item:m,index:b})})])]})}}),_=t.defineComponent({name:"STree",props:E,emits:["lazy-load"],setup(l,e){const{data:d,height:c,itemHeight:n}=t.toRefs(l),{slots:r}=e,s=A(d,l,e);return t.provide("TREE_UTILS",s),()=>{const o=a=>t.createVNode(F,t.mergeProps(l,{treeNode:a}),{content:()=>r.content?r.content(a):a.label,icon:()=>r.icon?r.icon({nodeData:a,toggleNode:s.toggleNode}):t.createVNode(J,{expanded:!!a.expanded,onClick:()=>s.toggleNode(a)},null),loading:()=>r.loading?r.loading({nodeData:s}):t.createVNode("span",{class:"ml-1"},[t.createTextVNode("loading...")])});return t.createVNode("div",{class:"s-tree"},[c!=null&&c.value?t.createVNode("div",{style:{height:`${c.value}px`}},[t.createVNode(Q,{data:s.expandedTree.value,itemHeight:n.value},{default:({item:a})=>o(a)})]):s.expandedTree.value.map(a=>o(a))])}}}),W={install(l){l.component(_.name,_)}},oe="",X=[z,W],Z={version:"0.0.1",install(l){X.forEach(e=>l.use(e))}};T.Button=D,T.Tree=_,T.default=Z,Object.defineProperties(T,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
