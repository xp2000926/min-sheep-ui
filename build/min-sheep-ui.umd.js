(function(b,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(b=typeof globalThis<"u"?globalThis:b||self,t(b["min-sheep-ui"]={},b.Vue))})(this,function(b,t){"use strict";const $={type:{type:String,default:"secondary"},size:{type:String,default:"medium"},disabled:{type:Boolean,default:!1},block:{type:Boolean,default:!1}},ce="",C=t.defineComponent({name:"SButton",props:$,setup(n,{slots:e}){const{type:l,size:c,disabled:o,block:r}=t.toRefs(n),d=r.value?"s-btn--block":"";return()=>t.createVNode("button",{disabled:o.value,class:`s-btn s-btn--${l.value} s-btn--${c.value} ${d}`},[e.default?e.default():"按钮"])}}),R={install(n){n.component(C.name,C)}};function L(n,e=0,l=[]){return e++,n.reduce((c,o)=>{const r={...o};r.level=e,l.length>0&&l[l.length-1].level>=e&&l.pop(),l.push(r);const d=l[l.length-2];if(d&&(r.parentId=d.id),r.children){const a=L(r.children,e,l);return delete r.children,c.concat(r,a)}else return r.isLeaf===void 0&&(r.isLeaf=!0),c.concat(r)},[])}function A(n,{getChildren:e}){return{toggleCheckNode:c=>{c.checked=!c.checked,e(c).forEach(a=>{a.checked=c.checked});const o=n.value.find(a=>a.id===c.parentId);if(!o)return;const r=e(o,!1),d=r.filter(a=>a.checked);d.length===r.length?o.checked=!0:d.length===0&&(o.checked=!1)}}}function q(n){const e=t.computed(()=>{let a=[];const s=[];for(const u of n.value)a.map(i=>i.id).includes(u.id)||(u.expanded!==!0&&(a=l(u)),s.push(u));return s}),l=(a,s=!0)=>{const u=[],i=n.value.findIndex(h=>h.id===a.id);for(let h=i+1;h<n.value.length&&a.level<n.value[h].level;h++)(s||a.level===n.value[h].level-1)&&u.push(n.value[h]);return u},c=(a,s=[])=>{const u=l(a,!1);return s.push(...u),u.forEach(i=>{i.expanded&&c(i,s)}),s};return{expandedTree:e,getChildren:l,getChildrenExpanded:c,getIndex:a=>a?n.value.findIndex(s=>s.id===a.id):-1,getNode:a=>n.value.find(s=>s.id===a.id),getParent:a=>n.value.find(s=>s.id===a.parentId)}}const D={dropPrev:"s-tree__node--drop-prev",dropNext:"s-tree__node--drop-next",dropInner:"s-tree__node--drop-inner"};function U(n,e,{getChildren:l,getParent:c}){const o=t.reactive({dropType:void 0,draggingNode:null,draggingTreeNode:null}),r=t.computed(()=>e.value.reduce((p,f)=>({...p,[f.id]:f}),{})),d=p=>{p==null||p.classList.remove(...Object.values(D))},a=(p,f)=>{var v;const g=(v=r.value[p])==null?void 0:v.parentId;return g===f?!0:g!==void 0?a(g,f):!1},s=()=>{o.dropType=void 0,o.draggingNode=null,o.draggingTreeNode=null},u=(p,f)=>{var g;p.stopPropagation(),o.draggingNode=p.target,o.draggingTreeNode=f,(g=p.dataTransfer)==null||g.setData("dragNodeId",f.id)},i=p=>{if(p.preventDefault(),p.stopPropagation(),!!o.draggingNode&&n){if(p.dataTransfer&&(p.dataTransfer.dropEffect="move"),!e)return;let f={};typeof n=="object"?f=n:n===!0&&(f={dropInner:!0});const{dropPrev:g,dropNext:v,dropInner:N}=f;let m;const y=g?N?.25:v?.45:1:-1,P=v?N?.75:g?.55:0:1,I=p.currentTarget,V=I==null?void 0:I.getBoundingClientRect(),H=p.clientY-((V==null?void 0:V.top)||0);if(H<((V==null?void 0:V.height)||0)*y?m="dropPrev":H>((V==null?void 0:V.height)||0)*P?m="dropNext":N?m="dropInner":m=void 0,m){const M=I==null?void 0:I.classList;M&&(M.contains(D[m])||(d(I),M.add(D[m])))}else d(I);o.dropType=m}},h=p=>{p.stopPropagation(),o.draggingNode&&d(p.currentTarget)},x=(p,f)=>{var v;if(p.preventDefault(),p.stopPropagation(),d(p.currentTarget),!o.draggingNode||!n)return;const g=(v=p.dataTransfer)==null?void 0:v.getData("dragNodeId");if(g){const N=a(f.id,g);if(g===f.id||N)return;o.dropType&&T(g,f),s()}};function T(p,f){const g=e.value.find(v=>v.id===p);if(g){let v;const N=l(g),m=c(g);if(o.dropType==="dropInner"){v={...g,parentId:f.id,level:f.level+1};const y=e.value.indexOf(f);e.value.splice(y+1,0,v),f.isLeaf=void 0;const P=e.value.indexOf(g);e.value.splice(P,1)}else if(o.dropType==="dropNext"){v={...g,parentId:f.parentId,level:f.level};const y=e.value.indexOf(f),P=l(f,!0).length;e.value.splice(y+P+1,0,v);const I=e.value.indexOf(g);e.value.splice(I,1)}else if(o.dropType==="dropPrev"){v={...g,parentId:f.parentId,level:f.level};const y=e.value.indexOf(f);e.value.splice(y,0,v);const P=e.value.indexOf(g);e.value.splice(P,1)}o.dropType="dropInner",N.forEach(y=>T(y.id,v)),m&&l(m).length===0&&(m.isLeaf=!0)}}return{onDragstart:u,onDragover:i,onDragleave:h,onDrop:x,onDragend:p=>{p.preventDefault(),p.stopPropagation(),s()}}}function Y(n,{getNode:e,getIndex:l,getChildren:c},{emit:o}){const r=u=>{const i=e(u);i&&i.isLeaf===!1&&!i.childNodeCount&&(i.loading=!0,o("lazy-load",u,d))},d=u=>{const i=e(u.node);if(i){i.loading=!1;const h=t.ref(L(u.treeItems,i.level));a(i,h),s(i,h);const x=c(i);i.childNodeCount=x.length}},a=(u,i)=>{i.value.forEach(h=>{h.level-1===u.level&&!h.parentId&&(h.parentId=u.id)})},s=(u,i)=>{const h=l(u);h&&n.value.splice(h+1,0,...i.value)};return{lazyLoadNodes:r}}function G(n=8){const e="abcdefghijklmnopqrstuvwxyz0123456789";let l="";for(let c=0;c<n;c++)l+=e[parseInt((Math.random()*e.length).toString())];return l}function F(n,{getChildren:e,getIndex:l}){return{append:(r,d)=>{const a=e(r,!1),s=a[a.length-1];let u=l(r)+1;s&&(u=l(s)+1),r.expanded=!0,r.isLeaf=!1;const i=t.ref({...d,level:r.level+1,parentId:r.id,isLeaf:!0});i.value.id===void 0&&(i.value.id=G()),n.value.splice(u,0,i.value)},remove:r=>{const d=e(r).map(a=>a.id);n.value=n.value.filter(a=>a.id!==r.id&&!d.includes(a.id))}}}function J(n,e,l,c){const{lazyLoadNodes:o}=c;return{toggleNode:d=>{const a=n.value.find(s=>s.id===d.id);a&&(a.expanded=!a.expanded,a.expanded&&o(a))}}}function K(n,e,l){const c=t.unref(n),o=t.ref(L(c)),r=q(o),d=[J,A,F],a=Y(o,r,l),s=U(e.draggable,o,r);return{...d.reduce((i,h)=>({...i,...h(o,r,l,a)}),{}),...r,...s,treeData:o}}const O={data:{type:Object,required:!0},lineable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1},draggable:{type:[Boolean,Object],default:!1},height:{type:Number},itemHeight:{type:Number,default:30}},Q={...O,treeNode:{type:Object,required:!0}},w=32,B=24,W=t.defineComponent({name:"STreeNode",props:Q,setup(n,{slots:e}){const{lineable:l,checkable:c,treeNode:o,operable:r,draggable:d}=t.toRefs(n),{toggleCheckNode:a,getChildrenExpanded:s,append:u,remove:i,onDragend:h,onDragleave:x,onDragover:T,onDragstart:k,onDrop:p}=t.inject("TREE_UTILS"),f=t.ref(!1),g=()=>{f.value?f.value=!1:f.value=!0};let v={};return d.value&&(v={draggable:!0,onDragend:N=>h(N),onDragleave:N=>x(N),onDragover:N=>T(N),onDragstart:N=>k(N,o.value),onDrop:N=>p(N,o.value)}),()=>{var N,m,y;return t.createVNode("div",{class:"s-tree__node hover:bg-slate-300 relative leading-8",style:{paddingLeft:`${B*(o.value.level-1)}px`},onMouseenter:g,onMouseleave:g},[!o.value.isLeaf&&o.value.expanded&&l.value&&t.createVNode("span",{class:"s-tree-node__vline absolute w-px bg-slate-300",style:{height:`${w*s(o.value).length}px`,left:`${B*(o.value.level-1)+9}px`,top:`${w}px`}},null),t.createVNode("div",t.mergeProps({class:"s-tree__node--content"},v),[o.value.isLeaf?t.createVNode("span",{style:{display:"inline-block",width:"18px"}},null):(N=e.icon)==null?void 0:N.call(e),c.value&&t.withDirectives(t.createVNode("input",{type:"checkbox","onUpdate:modelValue":P=>o.value.checked=P,onClick:()=>{a(o.value)}},null),[[t.vModelCheckbox,o.value.checked]]),(m=e.content)==null?void 0:m.call(e),r.value&&f.value&&t.createVNode("span",{class:"inline-flex ml-1"},[t.createVNode("svg",{onClick:()=>{u(o.value,{label:"新节点"})},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer"},[t.createVNode("path",{d:"M590.769231 571.076923h324.923077c15.753846 0 29.538462-13.784615 29.538461-29.538461v-59.076924c0-15.753846-13.784615-29.538462-29.538461-29.538461H590.769231c-11.815385 0-19.692308-7.876923-19.692308-19.692308V108.307692c0-15.753846-13.784615-29.538462-29.538461-29.538461h-59.076924c-15.753846 0-29.538462 13.784615-29.538461 29.538461V433.230769c0 11.815385-7.876923 19.692308-19.692308 19.692308H108.307692c-15.753846 0-29.538462 13.784615-29.538461 29.538461v59.076924c0 15.753846 13.784615 29.538462 29.538461 29.538461H433.230769c11.815385 0 19.692308 7.876923 19.692308 19.692308v324.923077c0 15.753846 13.784615 29.538462 29.538461 29.538461h59.076924c15.753846 0 29.538462-13.784615 29.538461-29.538461V590.769231c0-11.815385 7.876923-19.692308 19.692308-19.692308z"},null)]),t.createVNode("svg",{onClick:()=>{i(o.value)},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer ml-1"},[t.createVNode("path",{d:"M610.461538 500.184615l256-257.96923c11.815385-11.815385 11.815385-29.538462 0-41.353847l-39.384615-41.353846c-11.815385-11.815385-29.538462-11.815385-41.353846 0L527.753846 417.476923c-7.876923 7.876923-19.692308 7.876923-27.569231 0L242.215385 157.538462c-11.815385-11.815385-29.538462-11.815385-41.353847 0l-41.353846 41.353846c-11.815385 11.815385-11.815385 29.538462 0 41.353846l257.969231 257.969231c7.876923 7.876923 7.876923 19.692308 0 27.56923L157.538462 785.723077c-11.815385 11.815385-11.815385 29.538462 0 41.353846l41.353846 41.353846c11.815385 11.815385 29.538462 11.815385 41.353846 0L498.215385 610.461538c7.876923-7.876923 19.692308-7.876923 27.56923 0l257.969231 257.969231c11.815385 11.815385 29.538462 11.815385 41.353846 0L866.461538 827.076923c11.815385-11.815385 11.815385-29.538462 0-41.353846L610.461538 527.753846c-7.876923-7.876923-7.876923-19.692308 0-27.569231z"},null)])]),o.value.loading&&((y=e.loading)==null?void 0:y.call(e))])])}}}),X=(n,{emit:e})=>t.createVNode("svg",{style:{width:"18px",height:"18px",display:"inline-block",transform:n.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",onClick:()=>e("onClick")},[t.createVNode("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)]),de="",Z={data:{type:Array,default:[]},itemHeight:{type:Number,default:22},component:{type:String,default:"div"}},se="",ee=t.defineComponent({name:"SVirtualList",props:Z,setup(n,{slots:e}){const{data:l,itemHeight:c,component:o}=t.toRefs(n),r=t.ref(),d=t.ref(0),a=t.ref(0),s=t.ref(0),u=t.computed(()=>Math.ceil(d.value/c.value)),i=t.computed(()=>l.value.slice(s.value,Math.min(s.value+u.value,l.value.length)));t.onMounted(()=>{var x;d.value=(x=r.value)==null?void 0:x.clientHeight});const h=x=>{const{scrollTop:T}=x.target;s.value=Math.floor(T/c.value),a.value=T-T%c.value};return()=>t.createVNode(o.value,{class:"s-virtual-list__container",ref:r,onScroll:h},{default:()=>[t.createVNode("div",{class:"s-virtual-list__blank",style:{height:`${l.value.length*c.value}px`}},null),t.createVNode("div",{class:"s-virtual-list",style:{transform:`translate3d(0, ${a.value}px, 0)`}},[i.value.map((x,T)=>{var k;return(k=e.default)==null?void 0:k.call(e,{item:x,index:T})})])]})}}),S=t.defineComponent({name:"STree",props:O,emits:["lazy-load"],setup(n,e){const{data:l,height:c,itemHeight:o}=t.toRefs(n),{slots:r}=e,d=K(l,n,e);return t.provide("TREE_UTILS",d),()=>{const a=s=>t.createVNode(W,t.mergeProps(n,{treeNode:s}),{content:()=>r.content?r.content(s):s.label,icon:()=>r.icon?r.icon({nodeData:s,toggleNode:d.toggleNode}):t.createVNode(X,{expanded:!!s.expanded,onClick:()=>d.toggleNode(s)},null),loading:()=>r.loading?r.loading({nodeData:d}):t.createVNode("span",{class:"ml-1"},[t.createTextVNode("loading...")])});return t.createVNode("div",{class:"s-tree"},[c!=null&&c.value?t.createVNode("div",{style:{height:`${c.value}px`}},[t.createVNode(ee,{data:d.expandedTree.value,itemHeight:o.value},{default:({item:s})=>a(s)})]):d.expandedTree.value.map(s=>a(s))])}}}),te={install(n){n.component(S.name,S)}},z={total:{type:Number,default:0},pageSize:{type:Number,default:10},pagerCount:{type:Number,default:7}},ie="";function j(n=1){const e=t.ref(n),l=d=>{e.value=d},c=d=>{e.value+=d};return{pageIndex:e,setPageIndex:l,jumpPage:c,prevPage:()=>c(-1),nextPage:()=>c(1)}}const ne=(n,e,l)=>{const c=Array.from(Array(n).keys());if(n<=l)return c.slice(2,n);{const o=Math.ceil(l/2);return e<=o?c.slice(2,l):e>=n-o+1?c.slice(n-l+2,n):c.slice(e-o+2,e+o-1)}},oe=z,_=t.defineComponent({name:"SPager",props:oe,setup(n){const{total:e,pageSize:l,pagerCount:c}=t.toRefs(n),o=t.computed(()=>Math.ceil(e.value/l.value)),{pageIndex:r,setPageIndex:d,jumpPage:a,prevPage:s,nextPage:u}=j(),i=t.computed(()=>ne(o.value,r.value,c.value));return{totalPage:o,pageIndex:r,setPageIndex:d,jumpPage:a,prevPage:s,nextPage:u,centerPages:i}},render(){const{pagerCount:n,totalPage:e,pageIndex:l,setPageIndex:c,jumpPage:o,centerPages:r}=this;return t.createVNode("ul",{class:"s-pager"},[t.createVNode("li",{onClick:()=>c(1),class:{current:l===1}},[t.createTextVNode("1")]),e>n&&l>Math.ceil(n/2)&&t.createVNode("li",{class:"more left",onClick:()=>o(-5)},[t.createTextVNode("...")]),r.map(d=>t.createVNode("li",{onClick:()=>c(d),class:{current:l===d}},[d])),e>n&&l<e-Math.ceil(n/2)+1&&t.createVNode("li",{class:"more right",onClick:()=>o(5)},[t.createTextVNode("...")]),e>1&&t.createVNode("li",{onClick:()=>c(e),class:{current:l===e}},[e])])}}),E=t.defineComponent({name:"SPagination",props:z,setup(n){const{prevPage:e,nextPage:l}=j();return()=>t.createVNode("div",{class:"s-pagination"},[t.createVNode("button",{onClick:()=>e()},[t.createTextVNode("上一页")]),t.createVNode(_,n,null),t.createVNode("button",{onClick:()=>l()},[t.createTextVNode("下一页")])])}}),le={install(n){n.component(E.name,E),n.component(_.name,_)}},ue="",re=[R,te,le],ae={version:"0.0.1",install(n){re.forEach(e=>n.use(e))}};b.Button=C,b.Pagination=E,b.Tree=S,b.default=ae,Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
