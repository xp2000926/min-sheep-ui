(function(p,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],l):(p=typeof globalThis<"u"?globalThis:p||self,l(p.index={},p.Vue))})(this,function(p,l){"use strict";function g(d,t=0,r=[]){return t++,d.reduce((i,o)=>{const c={...o};c.level=t,r.length>0&&r[r.length-1].level>=t&&r.pop(),r.push(c);const n=r[r.length-2];if(n&&(c.parentId=n.id),c.children){const e=g(c.children,t,r);return delete c.children,i.concat(c,e)}else return c.isLeaf===void 0&&(c.isLeaf=!0),i.concat(c)},[])}function y(d,{getChildren:t}){return{toggleCheckNode:i=>{i.checked=!i.checked,t(i).forEach(e=>{e.checked=i.checked});const o=d.value.find(e=>e.id===i.parentId);if(!o)return;const c=t(o,!1),n=c.filter(e=>e.checked);n.length===c.length?o.checked=!0:n.length===0&&(o.checked=!1)}}}function T(d){const t=l.computed(()=>{let n=[];const e=[];for(const u of d.value)n.map(s=>s.id).includes(u.id)||(u.expanded!==!0&&(n=r(u)),e.push(u));return e}),r=(n,e=!0)=>{const u=[],s=d.value.findIndex(a=>a.id===n.id);for(let a=s+1;a<d.value.length&&n.level<d.value[a].level;a++)(e||n.level===d.value[a].level-1)&&u.push(d.value[a]);return u},i=(n,e=[])=>{const u=r(n,!1);return e.push(...u),u.forEach(s=>{s.expanded&&i(s,e)}),e};return{expandedTree:t,getChildren:r,getChildrenExpanded:i,getIndex:n=>n?d.value.findIndex(e=>e.id===n.id):-1,getNode:n=>d.value.find(e=>e.id===n.id)}}function C(d,{getNode:t,getIndex:r,getChildren:i},{emit:o}){const c=s=>{const a=t(s);a&&a.isLeaf===!1&&!a.childNodeCount&&(a.loading=!0,o("lazy-load",s,n))},n=s=>{const a=t(s.node);if(a){a.loading=!1;const f=l.ref(g(s.treeItems,a.level));e(a,f),u(a,f);const h=i(a);a.childNodeCount=h.length}},e=(s,a)=>{a.value.forEach(f=>{f.level-1===s.level&&!f.parentId&&(f.parentId=s.id)})},u=(s,a)=>{const f=r(s);f&&d.value.splice(f+1,0,...a.value)};return{lazyLoadNodes:c}}function V(d=8){const t="abcdefghijklmnopqrstuvwxyz0123456789";let r="";for(let i=0;i<d;i++)r+=t[parseInt((Math.random()*t.length).toString())];return r}function I(d,{getChildren:t,getIndex:r}){return{append:(c,n)=>{const e=t(c,!1),u=e[e.length-1];let s=r(c)+1;u&&(s=r(u)+1),c.expanded=!0,c.isLeaf=!1;const a=l.ref({...n,level:c.level+1,parentId:c.id,isLeaf:!0});a.value.id===void 0&&(a.value.id=V()),d.value.splice(s,0,a.value)},remove:c=>{const n=t(c).map(e=>e.id);d.value=d.value.filter(e=>e.id!==c.id&&!n.includes(e.id))}}}function L(d,t,r,i){const{lazyLoadNodes:o}=i;return{toggleNode:n=>{const e=d.value.find(u=>u.id===n.id);e&&(e.expanded=!e.expanded,e.expanded&&o(e))}}}function w(d,t){const r=l.unref(d),i=l.ref(g(r)),o=T(i),c=[L,y,I],n=C(i,o,t);return{...c.reduce((u,s)=>({...u,...s(i,o,t,n)}),{}),...o,treeData:i}}const N={data:{type:Object,required:!0},lineable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1}},E={...N,treeNode:{type:Object,required:!0}},x=32,k=24,M=l.defineComponent({name:"STreeNode",props:E,setup(d,{slots:t}){const{lineable:r,checkable:i,treeNode:o,operable:c}=l.toRefs(d),{toggleCheckNode:n,getChildrenExpanded:e,append:u,remove:s}=l.inject("TREE_UTILS"),a=l.ref(!1),f=()=>{a.value?a.value=!1:a.value=!0};return()=>{var h,m,b;return l.createVNode("div",{class:"s-tree-node hover:bg-slate-300 relative leading-8",style:{paddingLeft:`${k*(o.value.level-1)}px`},onMouseenter:f,onMouseleave:f},[!o.value.isLeaf&&o.value.expanded&&r.value&&l.createVNode("span",{class:"s-tree-node__vline absolute w-px bg-slate-300",style:{height:`${x*e(o.value).length}px`,left:`${k*(o.value.level-1)+9}px`,top:`${x}px`}},null),o.value.isLeaf?l.createVNode("span",{style:{display:"inline-block",width:"18px"}},null):(h=t.icon)==null?void 0:h.call(t),i.value&&l.withDirectives(l.createVNode("input",{type:"checkbox","onUpdate:modelValue":_=>o.value.checked=_,onClick:()=>{n(o.value)}},null),[[l.vModelCheckbox,o.value.checked]]),(m=t.content)==null?void 0:m.call(t),c.value&&a.value&&l.createVNode("span",{class:"inline-flex ml-1"},[l.createVNode("svg",{onClick:()=>{u(o.value,{label:"新节点"})},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer"},[l.createVNode("path",{d:"M590.769231 571.076923h324.923077c15.753846 0 29.538462-13.784615 29.538461-29.538461v-59.076924c0-15.753846-13.784615-29.538462-29.538461-29.538461H590.769231c-11.815385 0-19.692308-7.876923-19.692308-19.692308V108.307692c0-15.753846-13.784615-29.538462-29.538461-29.538461h-59.076924c-15.753846 0-29.538462 13.784615-29.538461 29.538461V433.230769c0 11.815385-7.876923 19.692308-19.692308 19.692308H108.307692c-15.753846 0-29.538462 13.784615-29.538461 29.538461v59.076924c0 15.753846 13.784615 29.538462 29.538461 29.538461H433.230769c11.815385 0 19.692308 7.876923 19.692308 19.692308v324.923077c0 15.753846 13.784615 29.538462 29.538461 29.538461h59.076924c15.753846 0 29.538462-13.784615 29.538461-29.538461V590.769231c0-11.815385 7.876923-19.692308 19.692308-19.692308z"},null)]),l.createVNode("svg",{onClick:()=>{s(o.value)},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer ml-1"},[l.createVNode("path",{d:"M610.461538 500.184615l256-257.96923c11.815385-11.815385 11.815385-29.538462 0-41.353847l-39.384615-41.353846c-11.815385-11.815385-29.538462-11.815385-41.353846 0L527.753846 417.476923c-7.876923 7.876923-19.692308 7.876923-27.569231 0L242.215385 157.538462c-11.815385-11.815385-29.538462-11.815385-41.353847 0l-41.353846 41.353846c-11.815385 11.815385-11.815385 29.538462 0 41.353846l257.969231 257.969231c7.876923 7.876923 7.876923 19.692308 0 27.56923L157.538462 785.723077c-11.815385 11.815385-11.815385 29.538462 0 41.353846l41.353846 41.353846c11.815385 11.815385 29.538462 11.815385 41.353846 0L498.215385 610.461538c7.876923-7.876923 19.692308-7.876923 27.56923 0l257.969231 257.969231c11.815385 11.815385 29.538462 11.815385 41.353846 0L866.461538 827.076923c11.815385-11.815385 11.815385-29.538462 0-41.353846L610.461538 527.753846c-7.876923-7.876923-7.876923-19.692308 0-27.569231z"},null)])]),o.value.loading&&((b=t.loading)==null?void 0:b.call(t))])}}}),S=(d,{emit:t})=>l.createVNode("svg",{style:{width:"18px",height:"18px",display:"inline-block",transform:d.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",onClick:()=>t("onClick")},[l.createVNode("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)]),O="",v=l.defineComponent({name:"STree",props:N,emits:["lazy-load"],setup(d,t){const{data:r}=l.toRefs(d),{slots:i}=t,o=w(r,t);return l.provide("TREE_UTILS",o),()=>{var c;return l.createVNode("div",{class:"s-tree"},[(c=o.expandedTree)==null?void 0:c.value.map(n=>l.createVNode(M,l.mergeProps(d,{treeNode:n}),{content:()=>i.content?i.content(n):n.label,icon:()=>i.icon?i.icon({nodeData:n,toggleNode:o.toggleNode}):l.createVNode(S,{expanded:!!n.expanded,onClick:()=>o.toggleNode(n)},null),loading:()=>i.loading?i.loading({nodeData:o}):l.createVNode("span",{class:"ml-1"},[l.createTextVNode("loading...")])}))])}}}),z={install(d){d.component(v.name,v)}};p.Tree=v,p.default=z,Object.defineProperties(p,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
