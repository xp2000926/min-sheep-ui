(function(V,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(V=typeof globalThis<"u"?globalThis:V||self,n(V.index={},V.Vue))})(this,function(V,n){"use strict";function _(e,t=0,r=[]){return t++,e.reduce((p,a)=>{const s={...a};s.level=t,r.length>0&&r[r.length-1].level>=t&&r.pop(),r.push(s);const u=r[r.length-2];if(u&&(s.parentId=u.id),s.children){const l=_(s.children,t,r);return delete s.children,p.concat(s,l)}else return s.isLeaf===void 0&&(s.isLeaf=!0),p.concat(s)},[])}function j(e,{getChildren:t,getParent:r},{emit:p}){const a=u=>{u.checked=!u.checked,t(u).forEach(c=>{c.checked=u.checked,c.inChecked=t(u,!0).every(x=>x.inChecked)}),u.inChecked=!1,s(u);const l=e.value.map(c=>{if(c.checked)return c.id}).filter(Boolean),d=e.value.map(c=>{if(c.checked)return c}).filter(Boolean),o=e.value.map(c=>{if(c.inChecked)return c.id}).filter(Boolean),i=e.value.map(c=>{if(c.inChecked)return c}).filter(Boolean);p("check",u,l,d,o,i)},s=u=>{const l=r(u);if(!l)return;const d=t(l,!0),o=d.every(c=>c.checked);l.checked=o;const i=d.some(c=>c.checked);o?l.inChecked=!1:i?l.inChecked=!0:l.inChecked=!1,l.parentId&&s(l)};return{toggleCheckNode:a}}function H(e){const t=n.computed(()=>{let l=[];const d=[];for(const o of e.value)l.map(i=>i.id).includes(o.id)||(o.expanded!==!0&&(l=r(o)),d.push(o));return d}),r=(l,d=!0)=>{const o=[],i=e.value.findIndex(c=>c.id===l.id);for(let c=i+1;c<e.value.length&&l.level<e.value[c].level;c++)(d||l.level===e.value[c].level-1)&&o.push(e.value[c]);return o},p=(l,d=[])=>{const o=r(l,!1);return d.push(...o),o.forEach(i=>{i.expanded&&p(i,d)}),d};return{expandedTree:t,getChildren:r,getChildrenExpanded:p,getIndex:l=>l?e.value.findIndex(d=>d.id===l.id):-1,getNode:l=>e.value.find(d=>d.id===l.id),getParent:l=>e.value.find(d=>d.id===l.parentId)}}const L={dropPrev:"s-tree__node--drop-prev",dropNext:"s-tree__node--drop-next",dropInner:"s-tree__node--drop-inner"};function z(e,t,{getChildren:r,getParent:p}){const a=n.reactive({dropType:void 0,draggingNode:null,draggingTreeNode:null}),s=n.computed(()=>t.value.reduce((f,g)=>({...f,[g.id]:g}),{})),u=f=>{f==null||f.classList.remove(...Object.values(L))},l=(f,g)=>{var b;const h=(b=s.value[f])==null?void 0:b.parentId;return h===g?!0:h!==void 0?l(h,g):!1},d=()=>{a.dropType=void 0,a.draggingNode=null,a.draggingTreeNode=null},o=(f,g)=>{var h;f.stopPropagation(),a.draggingNode=f.target,a.draggingTreeNode=g,(h=f.dataTransfer)==null||h.setData("dragNodeId",g.id)},i=f=>{if(f.preventDefault(),f.stopPropagation(),!!a.draggingNode&&e){if(f.dataTransfer&&(f.dataTransfer.dropEffect="move"),!t)return;let g={};typeof e=="object"?g=e:e===!0&&(g={dropInner:!0});const{dropPrev:h,dropNext:b,dropInner:k}=g;let N;const v=h?k?.25:b?.45:1:-1,C=b?k?.75:h?.55:0:1,m=f.currentTarget,I=m==null?void 0:m.getBoundingClientRect(),M=f.clientY-((I==null?void 0:I.top)||0);if(M<((I==null?void 0:I.height)||0)*v?N="dropPrev":M>((I==null?void 0:I.height)||0)*C?N="dropNext":k?N="dropInner":N=void 0,N){const w=m==null?void 0:m.classList;w&&(w.contains(L[N])||(u(m),w.add(L[N])))}else u(m);a.dropType=N}},c=f=>{f.stopPropagation(),a.draggingNode&&u(f.currentTarget)},x=(f,g)=>{var b;if(f.preventDefault(),f.stopPropagation(),u(f.currentTarget),!a.draggingNode||!e)return;const h=(b=f.dataTransfer)==null?void 0:b.getData("dragNodeId");if(h){const k=l(g.id,h);if(h===g.id||k)return;a.dropType&&y(h,g),d()}};function y(f,g){const h=t.value.find(b=>b.id===f);if(h){let b;const k=r(h),N=p(h);if(a.dropType==="dropInner"){b={...h,parentId:g.id,level:g.level+1};const v=t.value.indexOf(g);t.value.splice(v+1,0,b),g.isLeaf=void 0;const C=t.value.indexOf(h);t.value.splice(C,1)}else if(a.dropType==="dropNext"){b={...h,parentId:g.parentId,level:g.level};const v=t.value.indexOf(g),C=r(g,!0).length;t.value.splice(v+C+1,0,b);const m=t.value.indexOf(h);t.value.splice(m,1)}else if(a.dropType==="dropPrev"){b={...h,parentId:g.parentId,level:g.level};const v=t.value.indexOf(g);t.value.splice(v,0,b);const C=t.value.indexOf(h);t.value.splice(C,1)}a.dropType="dropInner",k.forEach(v=>y(v.id,b)),N&&r(N).length===0&&(N.isLeaf=!0)}}return{onDragstart:o,onDragover:i,onDragleave:c,onDrop:x,onDragend:f=>{f.preventDefault(),f.stopPropagation(),d()}}}function $(e,{getNode:t,getIndex:r,getChildren:p},{emit:a}){const s=o=>{const i=t(o);i&&i.isLeaf===!1&&!i.childNodeCount&&(i.loading=!0,a("lazy-load",o,u))},u=o=>{const i=t(o.node);if(i){i.loading=!1;const c=n.ref(_(o.treeItems,i.level));l(i,c),d(i,c);const x=p(i);i.childNodeCount=x.length}},l=(o,i)=>{i.value.forEach(c=>{c.level-1===o.level&&!c.parentId&&(c.parentId=o.id)})},d=(o,i)=>{const c=r(o);c&&e.value.splice(c+1,0,...i.value)};return{lazyLoadNodes:s}}function A(e=8){const t="abcdefghijklmnopqrstuvwxyz0123456789";let r="";for(let p=0;p<e;p++)r+=t[parseInt((Math.random()*t.length).toString())];return r}function q(e,{getChildren:t,getIndex:r}){return{append:(s,u)=>{const l=t(s,!1),d=l[l.length-1];let o=r(s)+1;d&&(o=r(d)+1),s.expanded=!0,s.isLeaf=!1;const i=n.ref({...u,level:s.level+1,parentId:s.id,isLeaf:!0});i.value.id===void 0&&(i.value.id=A()),e.value.splice(o,0,i.value)},remove:s=>{const u=t(s).map(l=>l.id);e.value=e.value.filter(l=>l.id!==s.id&&!u.includes(l.id))}}}function F(e,t,r,p){const{lazyLoadNodes:a}=p;return{toggleNode:(u,l,d=!1)=>{if(u.stopPropagation(),d)e.value.forEach(o=>{o.level<=l.level?(o.level===l.level&&o.id!==l.id&&(o.expanded=!1),o.id===l.id&&(o.expanded=!o.expanded),o.expanded&&a(o)):o.expanded=!1});else{const o=e.value.find(i=>i.id===l.id);o&&(o.expanded=!o.expanded,o.expanded&&a(o))}}}}function K(e,t,r){const p=n.unref(e),a=n.ref(_(p)),s=H(a),u=[F,j,q],l=$(a,s,r),d=z(t.draggable,a,s);return{...u.reduce((i,c)=>({...i,...c(a,s,r,l)}),{}),...s,...d,treeData:a}}const O={data:{type:Object,required:!0},lineable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1},draggable:{type:[Boolean,Object],default:!1},height:{type:Number},itemHeight:{type:Number,default:30},accordion:{type:Boolean,default:!1},props:{type:Object,default:{label:"label",children:"children"}}},P={onClick:{type:Function,required:!0},disabled:{type:Boolean,default:!1},marginRight:{type:Number,default:8}},le="",te="";var B={},U={get exports(){return B},set exports(e){B=e}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(e){(function(){var t={}.hasOwnProperty;function r(){for(var p=[],a=0;a<arguments.length;a++){var s=arguments[a];if(s){var u=typeof s;if(u==="string"||u==="number")p.push(s);else if(Array.isArray(s)){if(s.length){var l=r.apply(null,s);l&&p.push(l)}}else if(u==="object"){if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]")){p.push(s.toString());continue}for(var d in s)t.call(s,d)&&s[d]&&p.push(d)}}}return p.join(" ")}e.exports?(r.default=r,e.exports=r):window.classNames=r})()})(U);const S=B,Y=n.defineComponent({name:"SBaseSelectAll",props:P,setup(e){return()=>n.createVNode("label",{class:S("s-base-select-all","is-checked",{"is-disabled":e.disabled}),style:{marginRight:e.marginRight+"px"}},[n.createVNode("span",{class:S("s-base-select-all__input","is-checked",{"is-disabled":e.disabled})},[n.createVNode("span",{class:"s-base-select-all__inner"},null),n.createVNode("input",{type:"checkbox",disabled:e.disabled,"aria-hidden":"false",class:"s-base-select-all__original",value:"",tabindex:"-1",onClick:()=>{e.onClick()}},null)])])}}),ae="",G=n.defineComponent({name:"SBaseSelectionBox",props:P,setup(e){return()=>n.createVNode("label",{class:S("s-base-selection-box",{"is-disabled":e.disabled}),style:{marginRight:e.marginRight+"px"}},[n.createVNode("span",{class:S("s-base-selection-box__input",{"is-disabled":e.disabled})},[n.createVNode("span",{class:"s-base-selection-box__inner"},null),n.createVNode("input",{type:"checkbox",disabled:e.disabled,"aria-hidden":"false",class:"s-base-selection-box__original",value:"",tabindex:"-1",onClick:()=>{e.onClick()}},null)])])}}),oe="",J=n.defineComponent({name:"SBaseSemiSelection",props:P,setup(e){return()=>n.createVNode("label",{class:S("s-base-semi-selection",{"is-disabled":e.disabled}),style:{marginRight:e.marginRight+"px"}},[n.createVNode("span",{class:S("s-base-semi-selection__input","is-indeterminate",{"is-disabled":e.disabled}),tabindex:"0",role:"checkbox","aria-checked":"mixed"},[n.createVNode("span",{class:"s-base-semi-selection__inner"},null),n.createVNode("input",{type:"checkbox","aria-hidden":"true",disabled:e.disabled,class:"s-base-semi-selection__original",value:"",tabindex:"-1",onClick:()=>{e.onClick()}},null)])])}}),Q={...O,treeNode:{type:Object,required:!0}},E=34,R=24,W=n.defineComponent({name:"STreeNode",props:Q,setup(e,{slots:t}){const{lineable:r,checkable:p,treeNode:a,operable:s,draggable:u,props:l}=n.toRefs(e),{toggleCheckNode:d,getChildrenExpanded:o,append:i,remove:c,onDragend:x,onDragleave:y,onDragover:T,onDragstart:f,onDrop:g}=n.inject("TREE_UTILS");console.log("defaultProps",l);const h=n.ref(!1),b=()=>{h.value?h.value=!1:h.value=!0};let k={};u.value&&(k={draggable:!0,onDragend:v=>x(v),onDragleave:v=>y(v),onDragover:v=>T(v),onDragstart:v=>f(v,a.value),onDrop:v=>g(v,a.value)});const N=()=>n.createVNode(n.Fragment,null,[a.value.inChecked?n.createVNode(J,{onClick:()=>d(a.value),disabled:a.value.disabled},null):a.value.checked?n.createVNode(Y,{onClick:()=>d(a.value),disabled:a.value.disabled},null):n.createVNode(G,{onClick:()=>d(a.value),disabled:a.value.disabled},null)]);return()=>{var v,C,m;return n.createVNode("div",{class:"s-tree__node hover:bg-slate-300 relative leading-8",style:{paddingLeft:`${R*(a.value.level-1)}px`},onMouseenter:b,onMouseleave:b},[!a.value.isLeaf&&a.value.expanded&&r.value&&n.createVNode("span",{class:"s-tree-node__vline absolute w-px bg-slate-300",style:{height:`${E*o(a.value).length}px`,left:`${R*(a.value.level-1)+9}px`,top:`${E}px`}},null),n.createVNode("div",n.mergeProps({class:"s-tree__node--content"},k),[a.value.isLeaf?n.createVNode("span",{style:{display:"inline-block",width:"18px"}},null):(v=t.icon)==null?void 0:v.call(t),p.value&&N(),(C=t.content)==null?void 0:C.call(t),s.value&&h.value&&n.createVNode("span",{class:"inline-flex ml-1"},[n.createVNode("svg",{onClick:()=>{i(a.value,{label:"新节点"})},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer"},[n.createVNode("path",{d:"M590.769231 571.076923h324.923077c15.753846 0 29.538462-13.784615 29.538461-29.538461v-59.076924c0-15.753846-13.784615-29.538462-29.538461-29.538461H590.769231c-11.815385 0-19.692308-7.876923-19.692308-19.692308V108.307692c0-15.753846-13.784615-29.538462-29.538461-29.538461h-59.076924c-15.753846 0-29.538462 13.784615-29.538461 29.538461V433.230769c0 11.815385-7.876923 19.692308-19.692308 19.692308H108.307692c-15.753846 0-29.538462 13.784615-29.538461 29.538461v59.076924c0 15.753846 13.784615 29.538462 29.538461 29.538461H433.230769c11.815385 0 19.692308 7.876923 19.692308 19.692308v324.923077c0 15.753846 13.784615 29.538462 29.538461 29.538461h59.076924c15.753846 0 29.538462-13.784615 29.538461-29.538461V590.769231c0-11.815385 7.876923-19.692308 19.692308-19.692308z"},null)]),n.createVNode("svg",{onClick:()=>{c(a.value)},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer ml-1"},[n.createVNode("path",{d:"M610.461538 500.184615l256-257.96923c11.815385-11.815385 11.815385-29.538462 0-41.353847l-39.384615-41.353846c-11.815385-11.815385-29.538462-11.815385-41.353846 0L527.753846 417.476923c-7.876923 7.876923-19.692308 7.876923-27.569231 0L242.215385 157.538462c-11.815385-11.815385-29.538462-11.815385-41.353847 0l-41.353846 41.353846c-11.815385 11.815385-11.815385 29.538462 0 41.353846l257.969231 257.969231c7.876923 7.876923 7.876923 19.692308 0 27.56923L157.538462 785.723077c-11.815385 11.815385-11.815385 29.538462 0 41.353846l41.353846 41.353846c11.815385 11.815385 29.538462 11.815385 41.353846 0L498.215385 610.461538c7.876923-7.876923 19.692308-7.876923 27.56923 0l257.969231 257.969231c11.815385 11.815385 29.538462 11.815385 41.353846 0L866.461538 827.076923c11.815385-11.815385 11.815385-29.538462 0-41.353846L610.461538 527.753846c-7.876923-7.876923-7.876923-19.692308 0-27.569231z"},null)])]),a.value.loading&&((m=t.loading)==null?void 0:m.call(t))])])}}}),X=(e,{emit:t})=>n.createVNode("svg",{style:{width:"18px",height:"18px",display:"inline-block",transform:e.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",onClick:()=>t("onClick")},[n.createVNode("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)]),se="",Z={data:{type:Array,default:[]},itemHeight:{type:Number,default:22},component:{type:String,default:"div"}},ie="",ee=n.defineComponent({name:"SVirtualList",props:Z,setup(e,{slots:t}){const{data:r,itemHeight:p,component:a}=n.toRefs(e),s=n.ref(),u=n.ref(0),l=n.ref(0),d=n.ref(0),o=n.computed(()=>Math.ceil(u.value/p.value)),i=n.computed(()=>r.value.slice(d.value,Math.min(d.value+o.value,r.value.length)));n.onMounted(()=>{var x;u.value=(x=s.value)==null?void 0:x.clientHeight});const c=x=>{const{scrollTop:y}=x.target;d.value=Math.floor(y/p.value),l.value=y-y%p.value};return()=>n.createVNode(a.value,{class:"s-virtual-list__container",ref:s,onScroll:c},{default:()=>[n.createVNode("div",{class:"s-virtual-list__blank",style:{height:`${r.value.length*p.value}px`}},null),n.createVNode("div",{class:"s-virtual-list",style:{transform:`translate3d(0, ${l.value}px, 0)`}},[i.value.map((x,y)=>{var T;return(T=t.default)==null?void 0:T.call(t,{item:x,index:y})})])]})}}),D=n.defineComponent({name:"STree",props:O,emits:["lazy-load","check"],setup(e,t){const{data:r,height:p,itemHeight:a,accordion:s,props:u}=n.toRefs(e),{slots:l}=t,d=K(r,e,t);return n.provide("TREE_UTILS",d),()=>{const o=i=>n.createVNode(W,n.mergeProps(e,{treeNode:i,onClick:s.value?c=>d.toggleNode(c,i,s.value):""}),{content:()=>l.content?l.content(i):u.value.label=="label"?i.label:i[u.value.label],icon:()=>l.icon?l.icon({nodeData:i,toggleNode:d.toggleNode}):n.createVNode(X,{expanded:!!i.expanded,onClick:c=>d.toggleNode(c,i,s.value)},null),loading:()=>l.loading?l.loading({nodeData:d}):n.createVNode("span",{class:"ml-1"},[n.createTextVNode("loading...")])});return n.createVNode("div",{class:"s-tree"},[p!=null&&p.value?n.createVNode("div",{style:{height:`${p.value}px`}},[n.createVNode(ee,{data:d.expandedTree.value,itemHeight:a.value},{default:({item:i})=>o(i)})]):d.expandedTree.value.map(i=>o(i))])}}}),ne={install(e){e.component(D.name,D)}};V.Tree=D,V.default=ne,Object.defineProperties(V,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
