(function(b,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],r):(b=typeof globalThis<"u"?globalThis:b||self,r(b.index={},b.Vue))})(this,function(b,r){"use strict";function L(t,n=0,d=[]){return n++,t.reduce((s,e)=>{const l={...e};l.level=n,d.length>0&&d[d.length-1].level>=n&&d.pop(),d.push(l);const u=d[d.length-2];if(u&&(l.parentId=u.id),l.children){const o=L(l.children,n,d);return delete l.children,s.concat(l,o)}else return l.isLeaf===void 0&&(l.isLeaf=!0),s.concat(l)},[])}function M(t,{getChildren:n}){return{toggleCheckNode:s=>{s.checked=!s.checked,n(s).forEach(o=>{o.checked=s.checked});const e=t.value.find(o=>o.id===s.parentId);if(!e)return;const l=n(e,!1),u=l.filter(o=>o.checked);u.length===l.length?e.checked=!0:u.length===0&&(e.checked=!1)}}}function z(t){const n=r.computed(()=>{let o=[];const f=[];for(const p of t.value)o.map(c=>c.id).includes(p.id)||(p.expanded!==!0&&(o=d(p)),f.push(p));return f}),d=(o,f=!0)=>{const p=[],c=t.value.findIndex(v=>v.id===o.id);for(let v=c+1;v<t.value.length&&o.level<t.value[v].level;v++)(f||o.level===t.value[v].level-1)&&p.push(t.value[v]);return p},s=(o,f=[])=>{const p=d(o,!1);return f.push(...p),p.forEach(c=>{c.expanded&&s(c,f)}),f};return{expandedTree:n,getChildren:d,getChildrenExpanded:s,getIndex:o=>o?t.value.findIndex(f=>f.id===o.id):-1,getNode:o=>t.value.find(f=>f.id===o.id),getParent:o=>t.value.find(f=>f.id===o.parentId)}}const V={dropPrev:"s-tree__node--drop-prev",dropNext:"s-tree__node--drop-next",dropInner:"s-tree__node--drop-inner"};function j(t,n,{getChildren:d,getParent:s}){const e=r.reactive({dropType:void 0,draggingNode:null,draggingTreeNode:null}),l=r.computed(()=>n.value.reduce((a,i)=>({...a,[i.id]:i}),{})),u=a=>{a==null||a.classList.remove(...Object.values(V))},o=(a,i)=>{var h;const g=(h=l.value[a])==null?void 0:h.parentId;return g===i?!0:g!==void 0?o(g,i):!1},f=()=>{e.dropType=void 0,e.draggingNode=null,e.draggingTreeNode=null},p=(a,i)=>{var g;a.stopPropagation(),e.draggingNode=a.target,e.draggingTreeNode=i,(g=a.dataTransfer)==null||g.setData("dragNodeId",i.id)},c=a=>{if(a.preventDefault(),a.stopPropagation(),!!e.draggingNode&&t){if(a.dataTransfer&&(a.dataTransfer.dropEffect="move"),!n)return;let i={};typeof t=="object"?i=t:t===!0&&(i={dropInner:!0});const{dropPrev:g,dropNext:h,dropInner:N}=i;let x;const I=g?N?.25:h?.45:1:-1,y=h?N?.75:g?.55:0:1,T=a.currentTarget,m=T==null?void 0:T.getBoundingClientRect(),S=a.clientY-((m==null?void 0:m.top)||0);if(S<((m==null?void 0:m.height)||0)*I?x="dropPrev":S>((m==null?void 0:m.height)||0)*y?x="dropNext":N?x="dropInner":x=void 0,x){const P=T==null?void 0:T.classList;P&&(P.contains(V[x])||(u(T),P.add(V[x])))}else u(T);e.dropType=x}},v=a=>{a.stopPropagation(),e.draggingNode&&u(a.currentTarget)},k=(a,i)=>{var h;if(a.preventDefault(),a.stopPropagation(),u(a.currentTarget),!e.draggingNode||!t)return;const g=(h=a.dataTransfer)==null?void 0:h.getData("dragNodeId");if(g){const N=o(i.id,g);if(g===i.id||N)return;e.dropType&&D(g,i),f()}};function D(a,i){const g=n.value.find(h=>h.id===a);if(g){let h;const N=d(g),x=s(g);if(e.dropType==="dropInner"){h={...g,parentId:i.id,level:i.level+1};const I=n.value.indexOf(i);n.value.splice(I+1,0,h),i.isLeaf=void 0;const y=n.value.indexOf(g);n.value.splice(y,1)}else if(e.dropType==="dropNext"){h={...g,parentId:i.parentId,level:i.level};const I=n.value.indexOf(i),y=d(i,!0).length;n.value.splice(I+y+1,0,h);const T=n.value.indexOf(g);n.value.splice(T,1)}else if(e.dropType==="dropPrev"){h={...g,parentId:i.parentId,level:i.level};const I=n.value.indexOf(i);n.value.splice(I,0,h);const y=n.value.indexOf(g);n.value.splice(y,1)}e.dropType="dropInner",N.forEach(I=>D(I.id,h)),x&&d(x).length===0&&(x.isLeaf=!0)}}return{onDragstart:p,onDragover:c,onDragleave:v,onDrop:k,onDragend:a=>{a.preventDefault(),a.stopPropagation(),f()}}}function B(t,{getNode:n,getIndex:d,getChildren:s},{emit:e}){const l=p=>{const c=n(p);c&&c.isLeaf===!1&&!c.childNodeCount&&(c.loading=!0,e("lazy-load",p,u))},u=p=>{const c=n(p.node);if(c){c.loading=!1;const v=r.ref(L(p.treeItems,c.level));o(c,v),f(c,v);const k=s(c);c.childNodeCount=k.length}},o=(p,c)=>{c.value.forEach(v=>{v.level-1===p.level&&!v.parentId&&(v.parentId=p.id)})},f=(p,c)=>{const v=d(p);v&&t.value.splice(v+1,0,...c.value)};return{lazyLoadNodes:l}}function H(t=8){const n="abcdefghijklmnopqrstuvwxyz0123456789";let d="";for(let s=0;s<t;s++)d+=n[parseInt((Math.random()*n.length).toString())];return d}function R(t,{getChildren:n,getIndex:d}){return{append:(l,u)=>{const o=n(l,!1),f=o[o.length-1];let p=d(l)+1;f&&(p=d(f)+1),l.expanded=!0,l.isLeaf=!1;const c=r.ref({...u,level:l.level+1,parentId:l.id,isLeaf:!0});c.value.id===void 0&&(c.value.id=H()),t.value.splice(p,0,c.value)},remove:l=>{const u=n(l).map(o=>o.id);t.value=t.value.filter(o=>o.id!==l.id&&!u.includes(o.id))}}}function q(t,n,d,s){const{lazyLoadNodes:e}=s;return{toggleNode:u=>{const o=t.value.find(f=>f.id===u.id);o&&(o.expanded=!o.expanded,o.expanded&&e(o))}}}function $(t,n,d){const s=r.unref(t),e=r.ref(L(s)),l=z(e),u=[q,M,R],o=B(e,l,d),f=j(n.draggable,e,l);return{...u.reduce((c,v)=>({...c,...v(e,l,d,o)}),{}),...l,...f,treeData:e}}const _={data:{type:Object,required:!0},lineable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1},draggable:{type:[Boolean,Object],default:!1}},U={..._,treeNode:{type:Object,required:!0}},O=32,w=24,G=r.defineComponent({name:"STreeNode",props:U,setup(t,{slots:n}){const{lineable:d,checkable:s,treeNode:e,operable:l,draggable:u}=r.toRefs(t),{toggleCheckNode:o,getChildrenExpanded:f,append:p,remove:c,onDragend:v,onDragleave:k,onDragover:D,onDragstart:E,onDrop:a}=r.inject("TREE_UTILS"),i=r.ref(!1),g=()=>{i.value?i.value=!1:i.value=!0};let h={};return u.value&&(h={draggable:!0,onDragend:N=>v(N),onDragleave:N=>k(N),onDragover:N=>D(N),onDragstart:N=>E(N,e.value),onDrop:N=>a(N,e.value)}),()=>{var N,x,I;return r.createVNode("div",{class:"s-tree__node hover:bg-slate-300 relative leading-8",style:{paddingLeft:`${w*(e.value.level-1)}px`},onMouseenter:g,onMouseleave:g},[!e.value.isLeaf&&e.value.expanded&&d.value&&r.createVNode("span",{class:"s-tree-node__vline absolute w-px bg-slate-300",style:{height:`${O*f(e.value).length}px`,left:`${w*(e.value.level-1)+9}px`,top:`${O}px`}},null),r.createVNode("div",r.mergeProps({class:"s-tree__node--content"},h),[e.value.isLeaf?r.createVNode("span",{style:{display:"inline-block",width:"18px"}},null):(N=n.icon)==null?void 0:N.call(n),s.value&&r.withDirectives(r.createVNode("input",{type:"checkbox","onUpdate:modelValue":y=>e.value.checked=y,onClick:()=>{o(e.value)}},null),[[r.vModelCheckbox,e.value.checked]]),(x=n.content)==null?void 0:x.call(n),l.value&&i.value&&r.createVNode("span",{class:"inline-flex ml-1"},[r.createVNode("svg",{onClick:()=>{p(e.value,{label:"新节点"})},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer"},[r.createVNode("path",{d:"M590.769231 571.076923h324.923077c15.753846 0 29.538462-13.784615 29.538461-29.538461v-59.076924c0-15.753846-13.784615-29.538462-29.538461-29.538461H590.769231c-11.815385 0-19.692308-7.876923-19.692308-19.692308V108.307692c0-15.753846-13.784615-29.538462-29.538461-29.538461h-59.076924c-15.753846 0-29.538462 13.784615-29.538461 29.538461V433.230769c0 11.815385-7.876923 19.692308-19.692308 19.692308H108.307692c-15.753846 0-29.538462 13.784615-29.538461 29.538461v59.076924c0 15.753846 13.784615 29.538462 29.538461 29.538461H433.230769c11.815385 0 19.692308 7.876923 19.692308 19.692308v324.923077c0 15.753846 13.784615 29.538462 29.538461 29.538461h59.076924c15.753846 0 29.538462-13.784615 29.538461-29.538461V590.769231c0-11.815385 7.876923-19.692308 19.692308-19.692308z"},null)]),r.createVNode("svg",{onClick:()=>{c(e.value)},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer ml-1"},[r.createVNode("path",{d:"M610.461538 500.184615l256-257.96923c11.815385-11.815385 11.815385-29.538462 0-41.353847l-39.384615-41.353846c-11.815385-11.815385-29.538462-11.815385-41.353846 0L527.753846 417.476923c-7.876923 7.876923-19.692308 7.876923-27.569231 0L242.215385 157.538462c-11.815385-11.815385-29.538462-11.815385-41.353847 0l-41.353846 41.353846c-11.815385 11.815385-11.815385 29.538462 0 41.353846l257.969231 257.969231c7.876923 7.876923 7.876923 19.692308 0 27.56923L157.538462 785.723077c-11.815385 11.815385-11.815385 29.538462 0 41.353846l41.353846 41.353846c11.815385 11.815385 29.538462 11.815385 41.353846 0L498.215385 610.461538c7.876923-7.876923 19.692308-7.876923 27.56923 0l257.969231 257.969231c11.815385 11.815385 29.538462 11.815385 41.353846 0L866.461538 827.076923c11.815385-11.815385 11.815385-29.538462 0-41.353846L610.461538 527.753846c-7.876923-7.876923-7.876923-19.692308 0-27.569231z"},null)])]),e.value.loading&&((I=n.loading)==null?void 0:I.call(n))])])}}}),Y=(t,{emit:n})=>r.createVNode("svg",{style:{width:"18px",height:"18px",display:"inline-block",transform:t.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",onClick:()=>n("onClick")},[r.createVNode("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)]),F="",C=r.defineComponent({name:"STree",props:_,emits:["lazy-load"],setup(t,n){const{data:d}=r.toRefs(t),{slots:s}=n,e=$(d,t,n);return r.provide("TREE_UTILS",e),()=>{var l;return r.createVNode("div",{class:"s-tree"},[(l=e.expandedTree)==null?void 0:l.value.map(u=>r.createVNode(G,r.mergeProps(t,{treeNode:u}),{content:()=>s.content?s.content(u):u.label,icon:()=>s.icon?s.icon({nodeData:u,toggleNode:e.toggleNode}):r.createVNode(Y,{expanded:!!u.expanded,onClick:()=>e.toggleNode(u)},null),loading:()=>s.loading?s.loading({nodeData:e}):r.createVNode("span",{class:"ml-1"},[r.createTextVNode("loading...")])}))])}}}),A={install(t){t.component(C.name,C)}};b.Tree=C,b.default=A,Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
