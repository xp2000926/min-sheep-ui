(function(V,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(V=typeof globalThis<"u"?globalThis:V||self,e(V.index={},V.Vue))})(this,function(V,e){"use strict";function _(a,n=0,i=[]){return n++,a.reduce((f,t)=>{const l={...t};l.level=n,i.length>0&&i[i.length-1].level>=n&&i.pop(),i.push(l);const c=i[i.length-2];if(c&&(l.parentId=c.id),l.children){const o=_(l.children,n,i);return delete l.children,f.concat(l,o)}else return l.isLeaf===void 0&&(l.isLeaf=!0),f.concat(l)},[])}function M(a,{getChildren:n,getParent:i}){const f=l=>{l.checked=!l.checked,l.inChecked=!1,n(l).forEach(c=>{c.checked=l.checked}),t(l)},t=l=>{const c=i(l);if(!c)return;const o=n(c,!0),r=o.every(s=>s.checked);c.checked=r;const d=o.some(s=>s.checked);r?c.inChecked=!1:d?c.inChecked=!0:c.inChecked=!1,c.parentId&&t(c)};return{toggleCheckNode:f}}function w(a){const n=e.computed(()=>{let o=[];const r=[];for(const d of a.value)o.map(s=>s.id).includes(d.id)||(d.expanded!==!0&&(o=i(d)),r.push(d));return r}),i=(o,r=!0)=>{const d=[],s=a.value.findIndex(h=>h.id===o.id);for(let h=s+1;h<a.value.length&&o.level<a.value[h].level;h++)(r||o.level===a.value[h].level-1)&&d.push(a.value[h]);return d},f=(o,r=[])=>{const d=i(o,!1);return r.push(...d),d.forEach(s=>{s.expanded&&f(s,r)}),r};return{expandedTree:n,getChildren:i,getChildrenExpanded:f,getIndex:o=>o?a.value.findIndex(r=>r.id===o.id):-1,getNode:o=>a.value.find(r=>r.id===o.id),getParent:o=>a.value.find(r=>r.id===o.parentId)}}const S={dropPrev:"s-tree__node--drop-prev",dropNext:"s-tree__node--drop-next",dropInner:"s-tree__node--drop-inner"};function H(a,n,{getChildren:i,getParent:f}){const t=e.reactive({dropType:void 0,draggingNode:null,draggingTreeNode:null}),l=e.computed(()=>n.value.reduce((u,p)=>({...u,[p.id]:p}),{})),c=u=>{u==null||u.classList.remove(...Object.values(S))},o=(u,p)=>{var v;const g=(v=l.value[u])==null?void 0:v.parentId;return g===p?!0:g!==void 0?o(g,p):!1},r=()=>{t.dropType=void 0,t.draggingNode=null,t.draggingTreeNode=null},d=(u,p)=>{var g;u.stopPropagation(),t.draggingNode=u.target,t.draggingTreeNode=p,(g=u.dataTransfer)==null||g.setData("dragNodeId",p.id)},s=u=>{if(u.preventDefault(),u.stopPropagation(),!!t.draggingNode&&a){if(u.dataTransfer&&(u.dataTransfer.dropEffect="move"),!n)return;let p={};typeof a=="object"?p=a:a===!0&&(p={dropInner:!0});const{dropPrev:g,dropNext:v,dropInner:N}=p;let x;const b=g?N?.25:v?.45:1:-1,C=v?N?.75:g?.55:0:1,k=u.currentTarget,I=k==null?void 0:k.getBoundingClientRect(),E=u.clientY-((I==null?void 0:I.top)||0);if(E<((I==null?void 0:I.height)||0)*b?x="dropPrev":E>((I==null?void 0:I.height)||0)*C?x="dropNext":N?x="dropInner":x=void 0,x){const D=k==null?void 0:k.classList;D&&(D.contains(S[x])||(c(k),D.add(S[x])))}else c(k);t.dropType=x}},h=u=>{u.stopPropagation(),t.draggingNode&&c(u.currentTarget)},m=(u,p)=>{var v;if(u.preventDefault(),u.stopPropagation(),c(u.currentTarget),!t.draggingNode||!a)return;const g=(v=u.dataTransfer)==null?void 0:v.getData("dragNodeId");if(g){const N=o(p.id,g);if(g===p.id||N)return;t.dropType&&y(g,p),r()}};function y(u,p){const g=n.value.find(v=>v.id===u);if(g){let v;const N=i(g),x=f(g);if(t.dropType==="dropInner"){v={...g,parentId:p.id,level:p.level+1};const b=n.value.indexOf(p);n.value.splice(b+1,0,v),p.isLeaf=void 0;const C=n.value.indexOf(g);n.value.splice(C,1)}else if(t.dropType==="dropNext"){v={...g,parentId:p.parentId,level:p.level};const b=n.value.indexOf(p),C=i(p,!0).length;n.value.splice(b+C+1,0,v);const k=n.value.indexOf(g);n.value.splice(k,1)}else if(t.dropType==="dropPrev"){v={...g,parentId:p.parentId,level:p.level};const b=n.value.indexOf(p);n.value.splice(b,0,v);const C=n.value.indexOf(g);n.value.splice(C,1)}t.dropType="dropInner",N.forEach(b=>y(b.id,v)),x&&i(x).length===0&&(x.isLeaf=!0)}}return{onDragstart:d,onDragover:s,onDragleave:h,onDrop:m,onDragend:u=>{u.preventDefault(),u.stopPropagation(),r()}}}function z(a,{getNode:n,getIndex:i,getChildren:f},{emit:t}){const l=d=>{const s=n(d);s&&s.isLeaf===!1&&!s.childNodeCount&&(s.loading=!0,t("lazy-load",d,c))},c=d=>{const s=n(d.node);if(s){s.loading=!1;const h=e.ref(_(d.treeItems,s.level));o(s,h),r(s,h);const m=f(s);s.childNodeCount=m.length}},o=(d,s)=>{s.value.forEach(h=>{h.level-1===d.level&&!h.parentId&&(h.parentId=d.id)})},r=(d,s)=>{const h=i(d);h&&a.value.splice(h+1,0,...s.value)};return{lazyLoadNodes:l}}function j(a=8){const n="abcdefghijklmnopqrstuvwxyz0123456789";let i="";for(let f=0;f<a;f++)i+=n[parseInt((Math.random()*n.length).toString())];return i}function $(a,{getChildren:n,getIndex:i}){return{append:(l,c)=>{const o=n(l,!1),r=o[o.length-1];let d=i(l)+1;r&&(d=i(r)+1),l.expanded=!0,l.isLeaf=!1;const s=e.ref({...c,level:l.level+1,parentId:l.id,isLeaf:!0});s.value.id===void 0&&(s.value.id=j()),a.value.splice(d,0,s.value)},remove:l=>{const c=n(l).map(o=>o.id);a.value=a.value.filter(o=>o.id!==l.id&&!c.includes(o.id))}}}function q(a,n,i,f){const{lazyLoadNodes:t}=f;return{toggleNode:c=>{const o=a.value.find(r=>r.id===c.id);o&&(o.expanded=!o.expanded,o.expanded&&t(o))}}}function R(a,n,i){const f=e.unref(a),t=e.ref(_(f)),l=w(t),c=[q,M,$],o=z(t,l,i),r=H(n.draggable,t,l);return{...c.reduce((s,h)=>({...s,...h(t,l,i,o)}),{}),...l,...r,treeData:t}}const P={data:{type:Object,required:!0},lineable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1},draggable:{type:[Boolean,Object],default:!1},height:{type:Number},itemHeight:{type:Number,default:30}},A={onClick:{type:Function,required:!0}},ne="",te="",F=e.defineComponent({name:"SBaseSelectAll",props:A,setup(a){return()=>e.createVNode("label",{class:"s-base-select-all is-checked"},[e.createVNode("span",{class:"s-base-select-all__input is-checked"},[e.createVNode("span",{class:"s-base-select-all__inner"},null),e.createVNode("input",{type:"checkbox","aria-hidden":"false",class:"s-base-select-all__original",value:"",tabindex:"-1",onClick:()=>{a.onClick()}},null)])])}}),U={onClick:{type:Function,required:!0}},le="",Y=e.defineComponent({name:"SBaseSelectionBox",props:U,setup(a){return()=>e.createVNode("label",{class:"s-base-selection-box"},[e.createVNode("span",{class:"s-base-selection-box__input"},[e.createVNode("span",{class:"s-base-selection-box__inner"},null),e.createVNode("input",{type:"checkbox","aria-hidden":"false",class:"s-base-selection-box__original",value:"",tabindex:"-1",onClick:()=>{a.onClick()}},null)])])}}),G={onClick:{type:Function,required:!0}},oe="",J=e.defineComponent({name:"SBaseSemiSelection",props:G,setup(a){return()=>e.createVNode("label",{class:"s-base-semi-selection","aria-controls":"undefined"},[e.createVNode("span",{class:"s-base-semi-selection__input is-indeterminate",tabindex:"0",role:"checkbox","aria-checked":"mixed"},[e.createVNode("span",{class:"s-base-semi-selection__inner"},null),e.createVNode("input",{type:"checkbox","aria-hidden":"true",class:"s-base-semi-selection__original",value:"",tabindex:"-1",onClick:()=>{a.onClick()}},null)])])}}),K={...P,treeNode:{type:Object,required:!0}},B=34,O=24,Q=e.defineComponent({name:"STreeNode",props:K,setup(a,{slots:n}){const{lineable:i,checkable:f,treeNode:t,operable:l,draggable:c}=e.toRefs(a),{toggleCheckNode:o,getChildrenExpanded:r,append:d,remove:s,onDragend:h,onDragleave:m,onDragover:y,onDragstart:T,onDrop:u}=e.inject("TREE_UTILS"),p=e.ref(!1),g=()=>{p.value?p.value=!1:p.value=!0};let v={};return c.value&&(v={draggable:!0,onDragend:N=>h(N),onDragleave:N=>m(N),onDragover:N=>y(N),onDragstart:N=>T(N,t.value),onDrop:N=>u(N,t.value)}),()=>{var N,x,b;return e.createVNode("div",{class:"s-tree__node hover:bg-slate-300 relative leading-8",style:{paddingLeft:`${O*(t.value.level-1)}px`},onMouseenter:g,onMouseleave:g},[!t.value.isLeaf&&t.value.expanded&&i.value&&e.createVNode("span",{class:"s-tree-node__vline absolute w-px bg-slate-300",style:{height:`${B*r(t.value).length}px`,left:`${O*(t.value.level-1)+9}px`,top:`${B}px`}},null),e.createVNode("div",e.mergeProps({class:"s-tree__node--content"},v),[t.value.isLeaf?e.createVNode("span",{style:{display:"inline-block",width:"18px"}},null):(N=n.icon)==null?void 0:N.call(n),f.value&&e.createVNode(e.Fragment,null,[t.value.inChecked?e.createVNode(J,{onClick:()=>o(t.value)},null):t.value.checked?e.createVNode(F,{onClick:()=>o(t.value)},null):e.createVNode(Y,{onClick:()=>o(t.value)},null)]),(x=n.content)==null?void 0:x.call(n),l.value&&p.value&&e.createVNode("span",{class:"inline-flex ml-1"},[e.createVNode("svg",{onClick:()=>{d(t.value,{label:"新节点"})},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer"},[e.createVNode("path",{d:"M590.769231 571.076923h324.923077c15.753846 0 29.538462-13.784615 29.538461-29.538461v-59.076924c0-15.753846-13.784615-29.538462-29.538461-29.538461H590.769231c-11.815385 0-19.692308-7.876923-19.692308-19.692308V108.307692c0-15.753846-13.784615-29.538462-29.538461-29.538461h-59.076924c-15.753846 0-29.538462 13.784615-29.538461 29.538461V433.230769c0 11.815385-7.876923 19.692308-19.692308 19.692308H108.307692c-15.753846 0-29.538462 13.784615-29.538461 29.538461v59.076924c0 15.753846 13.784615 29.538462 29.538461 29.538461H433.230769c11.815385 0 19.692308 7.876923 19.692308 19.692308v324.923077c0 15.753846 13.784615 29.538462 29.538461 29.538461h59.076924c15.753846 0 29.538462-13.784615 29.538461-29.538461V590.769231c0-11.815385 7.876923-19.692308 19.692308-19.692308z"},null)]),e.createVNode("svg",{onClick:()=>{s(t.value)},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer ml-1"},[e.createVNode("path",{d:"M610.461538 500.184615l256-257.96923c11.815385-11.815385 11.815385-29.538462 0-41.353847l-39.384615-41.353846c-11.815385-11.815385-29.538462-11.815385-41.353846 0L527.753846 417.476923c-7.876923 7.876923-19.692308 7.876923-27.569231 0L242.215385 157.538462c-11.815385-11.815385-29.538462-11.815385-41.353847 0l-41.353846 41.353846c-11.815385 11.815385-11.815385 29.538462 0 41.353846l257.969231 257.969231c7.876923 7.876923 7.876923 19.692308 0 27.56923L157.538462 785.723077c-11.815385 11.815385-11.815385 29.538462 0 41.353846l41.353846 41.353846c11.815385 11.815385 29.538462 11.815385 41.353846 0L498.215385 610.461538c7.876923-7.876923 19.692308-7.876923 27.56923 0l257.969231 257.969231c11.815385 11.815385 29.538462 11.815385 41.353846 0L866.461538 827.076923c11.815385-11.815385 11.815385-29.538462 0-41.353846L610.461538 527.753846c-7.876923-7.876923-7.876923-19.692308 0-27.569231z"},null)])]),t.value.loading&&((b=n.loading)==null?void 0:b.call(n))])])}}}),W=(a,{emit:n})=>e.createVNode("svg",{style:{width:"18px",height:"18px",display:"inline-block",transform:a.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",onClick:()=>n("onClick")},[e.createVNode("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)]),ae="",X={data:{type:Array,default:[]},itemHeight:{type:Number,default:22},component:{type:String,default:"div"}},re="",Z=e.defineComponent({name:"SVirtualList",props:X,setup(a,{slots:n}){const{data:i,itemHeight:f,component:t}=e.toRefs(a),l=e.ref(),c=e.ref(0),o=e.ref(0),r=e.ref(0),d=e.computed(()=>Math.ceil(c.value/f.value)),s=e.computed(()=>i.value.slice(r.value,Math.min(r.value+d.value,i.value.length)));e.onMounted(()=>{var m;c.value=(m=l.value)==null?void 0:m.clientHeight});const h=m=>{const{scrollTop:y}=m.target;r.value=Math.floor(y/f.value),o.value=y-y%f.value};return()=>e.createVNode(t.value,{class:"s-virtual-list__container",ref:l,onScroll:h},{default:()=>[e.createVNode("div",{class:"s-virtual-list__blank",style:{height:`${i.value.length*f.value}px`}},null),e.createVNode("div",{class:"s-virtual-list",style:{transform:`translate3d(0, ${o.value}px, 0)`}},[s.value.map((m,y)=>{var T;return(T=n.default)==null?void 0:T.call(n,{item:m,index:y})})])]})}}),L=e.defineComponent({name:"STree",props:P,emits:["lazy-load"],setup(a,n){const{data:i,height:f,itemHeight:t}=e.toRefs(a),{slots:l}=n,c=R(i,a,n);return e.provide("TREE_UTILS",c),()=>{const o=r=>e.createVNode(Q,e.mergeProps(a,{treeNode:r}),{content:()=>l.content?l.content(r):r.label,icon:()=>l.icon?l.icon({nodeData:r,toggleNode:c.toggleNode}):e.createVNode(W,{expanded:!!r.expanded,onClick:()=>c.toggleNode(r)},null),loading:()=>l.loading?l.loading({nodeData:c}):e.createVNode("span",{class:"ml-1"},[e.createTextVNode("loading...")])});return e.createVNode("div",{class:"s-tree"},[f!=null&&f.value?e.createVNode("div",{style:{height:`${f.value}px`}},[e.createVNode(Z,{data:c.expandedTree.value,itemHeight:t.value},{default:({item:r})=>o(r)})]):c.expandedTree.value.map(r=>o(r))])}}}),ee={install(a){a.component(L.name,L)}};V.Tree=L,V.default=ee,Object.defineProperties(V,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
