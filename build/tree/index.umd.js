(function(C,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(C=typeof globalThis<"u"?globalThis:C||self,n(C.index={},C.Vue))})(this,function(C,n){"use strict";function _(o,l=0,d=[]){return l++,o.reduce((f,a)=>{const r={...a};r.level=l,d.length>0&&d[d.length-1].level>=l&&d.pop(),d.push(r);const s=d[d.length-2];if(s&&(r.parentId=s.id),r.children){const t=_(r.children,l,d);return delete r.children,f.concat(r,t)}else return r.isLeaf===void 0&&(r.isLeaf=!0),f.concat(r)},[])}function w(o,{getChildren:l,getParent:d},{emit:f}){const a=s=>{s.checked=!s.checked,l(s).forEach(e=>{e.checked=s.checked,e.inChecked=l(s,!0).every(c=>c.inChecked)}),s.inChecked=!1,r(s);const t=o.value.map(e=>e.checked?e.id:"").filter(e=>e),i=o.value.map(e=>e.checked?e:"").filter(e=>e);f("check",s,t,i)},r=s=>{const t=d(s);if(!t)return;const i=l(t,!0),e=i.every(g=>g.checked);t.checked=e;const c=i.some(g=>g.checked);e?t.inChecked=!1:c?t.inChecked=!0:t.inChecked=!1,t.parentId&&r(t)};return{toggleCheckNode:a}}function M(o){const l=n.computed(()=>{let t=[];const i=[];for(const e of o.value)t.map(c=>c.id).includes(e.id)||(e.expanded!==!0&&(t=d(e)),i.push(e));return i}),d=(t,i=!0)=>{const e=[],c=o.value.findIndex(g=>g.id===t.id);for(let g=c+1;g<o.value.length&&t.level<o.value[g].level;g++)(i||t.level===o.value[g].level-1)&&e.push(o.value[g]);return e},f=(t,i=[])=>{const e=d(t,!1);return i.push(...e),e.forEach(c=>{c.expanded&&f(c,i)}),i};return{expandedTree:l,getChildren:d,getChildrenExpanded:f,getIndex:t=>t?o.value.findIndex(i=>i.id===t.id):-1,getNode:t=>o.value.find(i=>i.id===t.id),getParent:t=>o.value.find(i=>i.id===t.parentId)}}const S={dropPrev:"s-tree__node--drop-prev",dropNext:"s-tree__node--drop-next",dropInner:"s-tree__node--drop-inner"};function H(o,l,{getChildren:d,getParent:f}){const a=n.reactive({dropType:void 0,draggingNode:null,draggingTreeNode:null}),r=n.computed(()=>l.value.reduce((u,p)=>({...u,[p.id]:p}),{})),s=u=>{u==null||u.classList.remove(...Object.values(S))},t=(u,p)=>{var v;const h=(v=r.value[u])==null?void 0:v.parentId;return h===p?!0:h!==void 0?t(h,p):!1},i=()=>{a.dropType=void 0,a.draggingNode=null,a.draggingTreeNode=null},e=(u,p)=>{var h;u.stopPropagation(),a.draggingNode=u.target,a.draggingTreeNode=p,(h=u.dataTransfer)==null||h.setData("dragNodeId",p.id)},c=u=>{if(u.preventDefault(),u.stopPropagation(),!!a.draggingNode&&o){if(u.dataTransfer&&(u.dataTransfer.dropEffect="move"),!l)return;let p={};typeof o=="object"?p=o:o===!0&&(p={dropInner:!0});const{dropPrev:h,dropNext:v,dropInner:x}=p;let N;const m=h?x?.25:v?.45:1:-1,V=v?x?.75:h?.55:0:1,y=u.currentTarget,I=y==null?void 0:y.getBoundingClientRect(),O=u.clientY-((I==null?void 0:I.top)||0);if(O<((I==null?void 0:I.height)||0)*m?N="dropPrev":O>((I==null?void 0:I.height)||0)*V?N="dropNext":x?N="dropInner":N=void 0,N){const D=y==null?void 0:y.classList;D&&(D.contains(S[N])||(s(y),D.add(S[N])))}else s(y);a.dropType=N}},g=u=>{u.stopPropagation(),a.draggingNode&&s(u.currentTarget)},b=(u,p)=>{var v;if(u.preventDefault(),u.stopPropagation(),s(u.currentTarget),!a.draggingNode||!o)return;const h=(v=u.dataTransfer)==null?void 0:v.getData("dragNodeId");if(h){const x=t(p.id,h);if(h===p.id||x)return;a.dropType&&k(h,p),i()}};function k(u,p){const h=l.value.find(v=>v.id===u);if(h){let v;const x=d(h),N=f(h);if(a.dropType==="dropInner"){v={...h,parentId:p.id,level:p.level+1};const m=l.value.indexOf(p);l.value.splice(m+1,0,v),p.isLeaf=void 0;const V=l.value.indexOf(h);l.value.splice(V,1)}else if(a.dropType==="dropNext"){v={...h,parentId:p.parentId,level:p.level};const m=l.value.indexOf(p),V=d(p,!0).length;l.value.splice(m+V+1,0,v);const y=l.value.indexOf(h);l.value.splice(y,1)}else if(a.dropType==="dropPrev"){v={...h,parentId:p.parentId,level:p.level};const m=l.value.indexOf(p);l.value.splice(m,0,v);const V=l.value.indexOf(h);l.value.splice(V,1)}a.dropType="dropInner",x.forEach(m=>k(m.id,v)),N&&d(N).length===0&&(N.isLeaf=!0)}}return{onDragstart:e,onDragover:c,onDragleave:g,onDrop:b,onDragend:u=>{u.preventDefault(),u.stopPropagation(),i()}}}function z(o,{getNode:l,getIndex:d,getChildren:f},{emit:a}){const r=e=>{const c=l(e);c&&c.isLeaf===!1&&!c.childNodeCount&&(c.loading=!0,a("lazy-load",e,s))},s=e=>{const c=l(e.node);if(c){c.loading=!1;const g=n.ref(_(e.treeItems,c.level));t(c,g),i(c,g);const b=f(c);c.childNodeCount=b.length}},t=(e,c)=>{c.value.forEach(g=>{g.level-1===e.level&&!g.parentId&&(g.parentId=e.id)})},i=(e,c)=>{const g=d(e);g&&o.value.splice(g+1,0,...c.value)};return{lazyLoadNodes:r}}function j(o=8){const l="abcdefghijklmnopqrstuvwxyz0123456789";let d="";for(let f=0;f<o;f++)d+=l[parseInt((Math.random()*l.length).toString())];return d}function R(o,{getChildren:l,getIndex:d}){return{append:(r,s)=>{const t=l(r,!1),i=t[t.length-1];let e=d(r)+1;i&&(e=d(i)+1),r.expanded=!0,r.isLeaf=!1;const c=n.ref({...s,level:r.level+1,parentId:r.id,isLeaf:!0});c.value.id===void 0&&(c.value.id=j()),o.value.splice(e,0,c.value)},remove:r=>{const s=l(r).map(t=>t.id);o.value=o.value.filter(t=>t.id!==r.id&&!s.includes(t.id))}}}function $(o,l,d,f){const{lazyLoadNodes:a}=f;return{toggleNode:(s,t,i=!1)=>{if(s.stopPropagation(),i)o.value.forEach(e=>{e.level===t.level&&e.id!==t.id&&(e.expanded=!1),e.id===t.id&&(e.expanded=!e.expanded),e.expanded&&a(e)});else{const e=o.value.find(c=>c.id===t.id);e&&(e.expanded=!e.expanded,e.expanded&&a(e))}}}}function q(o,l,d){const f=n.unref(o),a=n.ref(_(f)),r=M(a),s=[$,w,R],t=z(a,r,d),i=H(l.draggable,a,r);return{...s.reduce((c,g)=>({...c,...g(a,r,d,t)}),{}),...r,...i,treeData:a}}const P={data:{type:Object,required:!0},lineable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1},draggable:{type:[Boolean,Object],default:!1},height:{type:Number},itemHeight:{type:Number,default:30},accordion:{type:Boolean,default:!1}},A={onClick:{type:Function,required:!0}},ne="",te="",F=n.defineComponent({name:"SBaseSelectAll",props:A,setup(o){return()=>n.createVNode("label",{class:"s-base-select-all is-checked"},[n.createVNode("span",{class:"s-base-select-all__input is-checked"},[n.createVNode("span",{class:"s-base-select-all__inner"},null),n.createVNode("input",{type:"checkbox","aria-hidden":"false",class:"s-base-select-all__original",value:"",tabindex:"-1",onClick:()=>{o.onClick()}},null)])])}}),U={onClick:{type:Function,required:!0}},le="",Y=n.defineComponent({name:"SBaseSelectionBox",props:U,setup(o){return()=>n.createVNode("label",{class:"s-base-selection-box"},[n.createVNode("span",{class:"s-base-selection-box__input"},[n.createVNode("span",{class:"s-base-selection-box__inner"},null),n.createVNode("input",{type:"checkbox","aria-hidden":"false",class:"s-base-selection-box__original",value:"",tabindex:"-1",onClick:()=>{o.onClick()}},null)])])}}),G={onClick:{type:Function,required:!0}},oe="",K=n.defineComponent({name:"SBaseSemiSelection",props:G,setup(o){return()=>n.createVNode("label",{class:"s-base-semi-selection","aria-controls":"undefined"},[n.createVNode("span",{class:"s-base-semi-selection__input is-indeterminate",tabindex:"0",role:"checkbox","aria-checked":"mixed"},[n.createVNode("span",{class:"s-base-semi-selection__inner"},null),n.createVNode("input",{type:"checkbox","aria-hidden":"true",class:"s-base-semi-selection__original",value:"",tabindex:"-1",onClick:()=>{o.onClick()}},null)])])}}),J={...P,treeNode:{type:Object,required:!0}},B=34,E=24,Q=n.defineComponent({name:"STreeNode",props:J,setup(o,{slots:l}){const{lineable:d,checkable:f,treeNode:a,operable:r,draggable:s}=n.toRefs(o),{toggleCheckNode:t,getChildrenExpanded:i,append:e,remove:c,onDragend:g,onDragleave:b,onDragover:k,onDragstart:T,onDrop:u}=n.inject("TREE_UTILS"),p=n.ref(!1),h=()=>{p.value?p.value=!1:p.value=!0};let v={};return s.value&&(v={draggable:!0,onDragend:x=>g(x),onDragleave:x=>b(x),onDragover:x=>k(x),onDragstart:x=>T(x,a.value),onDrop:x=>u(x,a.value)}),()=>{var x,N,m;return n.createVNode("div",{class:"s-tree__node hover:bg-slate-300 relative leading-8",style:{paddingLeft:`${E*(a.value.level-1)}px`},onMouseenter:h,onMouseleave:h},[!a.value.isLeaf&&a.value.expanded&&d.value&&n.createVNode("span",{class:"s-tree-node__vline absolute w-px bg-slate-300",style:{height:`${B*i(a.value).length}px`,left:`${E*(a.value.level-1)+9}px`,top:`${B}px`}},null),n.createVNode("div",n.mergeProps({class:"s-tree__node--content"},v),[a.value.isLeaf?n.createVNode("span",{style:{display:"inline-block",width:"18px"}},null):(x=l.icon)==null?void 0:x.call(l),f.value&&n.createVNode(n.Fragment,null,[a.value.inChecked?n.createVNode(K,{onClick:()=>t(a.value)},null):a.value.checked?n.createVNode(F,{onClick:()=>t(a.value)},null):n.createVNode(Y,{onClick:()=>t(a.value)},null)]),(N=l.content)==null?void 0:N.call(l),r.value&&p.value&&n.createVNode("span",{class:"inline-flex ml-1"},[n.createVNode("svg",{onClick:()=>{e(a.value,{label:"新节点"})},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer"},[n.createVNode("path",{d:"M590.769231 571.076923h324.923077c15.753846 0 29.538462-13.784615 29.538461-29.538461v-59.076924c0-15.753846-13.784615-29.538462-29.538461-29.538461H590.769231c-11.815385 0-19.692308-7.876923-19.692308-19.692308V108.307692c0-15.753846-13.784615-29.538462-29.538461-29.538461h-59.076924c-15.753846 0-29.538462 13.784615-29.538461 29.538461V433.230769c0 11.815385-7.876923 19.692308-19.692308 19.692308H108.307692c-15.753846 0-29.538462 13.784615-29.538461 29.538461v59.076924c0 15.753846 13.784615 29.538462 29.538461 29.538461H433.230769c11.815385 0 19.692308 7.876923 19.692308 19.692308v324.923077c0 15.753846 13.784615 29.538462 29.538461 29.538461h59.076924c15.753846 0 29.538462-13.784615 29.538461-29.538461V590.769231c0-11.815385 7.876923-19.692308 19.692308-19.692308z"},null)]),n.createVNode("svg",{onClick:()=>{c(a.value)},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer ml-1"},[n.createVNode("path",{d:"M610.461538 500.184615l256-257.96923c11.815385-11.815385 11.815385-29.538462 0-41.353847l-39.384615-41.353846c-11.815385-11.815385-29.538462-11.815385-41.353846 0L527.753846 417.476923c-7.876923 7.876923-19.692308 7.876923-27.569231 0L242.215385 157.538462c-11.815385-11.815385-29.538462-11.815385-41.353847 0l-41.353846 41.353846c-11.815385 11.815385-11.815385 29.538462 0 41.353846l257.969231 257.969231c7.876923 7.876923 7.876923 19.692308 0 27.56923L157.538462 785.723077c-11.815385 11.815385-11.815385 29.538462 0 41.353846l41.353846 41.353846c11.815385 11.815385 29.538462 11.815385 41.353846 0L498.215385 610.461538c7.876923-7.876923 19.692308-7.876923 27.56923 0l257.969231 257.969231c11.815385 11.815385 29.538462 11.815385 41.353846 0L866.461538 827.076923c11.815385-11.815385 11.815385-29.538462 0-41.353846L610.461538 527.753846c-7.876923-7.876923-7.876923-19.692308 0-27.569231z"},null)])]),a.value.loading&&((m=l.loading)==null?void 0:m.call(l))])])}}}),W=(o,{emit:l})=>n.createVNode("svg",{style:{width:"18px",height:"18px",display:"inline-block",transform:o.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",onClick:()=>l("onClick")},[n.createVNode("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)]),ae="",X={data:{type:Array,default:[]},itemHeight:{type:Number,default:22},component:{type:String,default:"div"}},ce="",Z=n.defineComponent({name:"SVirtualList",props:X,setup(o,{slots:l}){const{data:d,itemHeight:f,component:a}=n.toRefs(o),r=n.ref(),s=n.ref(0),t=n.ref(0),i=n.ref(0),e=n.computed(()=>Math.ceil(s.value/f.value)),c=n.computed(()=>d.value.slice(i.value,Math.min(i.value+e.value,d.value.length)));n.onMounted(()=>{var b;s.value=(b=r.value)==null?void 0:b.clientHeight});const g=b=>{const{scrollTop:k}=b.target;i.value=Math.floor(k/f.value),t.value=k-k%f.value};return()=>n.createVNode(a.value,{class:"s-virtual-list__container",ref:r,onScroll:g},{default:()=>[n.createVNode("div",{class:"s-virtual-list__blank",style:{height:`${d.value.length*f.value}px`}},null),n.createVNode("div",{class:"s-virtual-list",style:{transform:`translate3d(0, ${t.value}px, 0)`}},[c.value.map((b,k)=>{var T;return(T=l.default)==null?void 0:T.call(l,{item:b,index:k})})])]})}}),L=n.defineComponent({name:"STree",props:P,emits:["lazy-load","check"],setup(o,l){const{data:d,height:f,itemHeight:a,accordion:r}=n.toRefs(o),{slots:s}=l,t=q(d,o,l);return n.provide("TREE_UTILS",t),()=>{const i=e=>n.createVNode(Q,n.mergeProps(o,{treeNode:e,onClick:r.value?c=>t.toggleNode(c,e,r.value):""}),{content:()=>s.content?s.content(e):e.label,icon:()=>s.icon?s.icon({nodeData:e,toggleNode:t.toggleNode}):n.createVNode(W,{expanded:!!e.expanded,onClick:c=>t.toggleNode(c,e,r.value)},null),loading:()=>s.loading?s.loading({nodeData:t}):n.createVNode("span",{class:"ml-1"},[n.createTextVNode("loading...")])});return n.createVNode("div",{class:"s-tree"},[f!=null&&f.value?n.createVNode("div",{style:{height:`${f.value}px`}},[n.createVNode(Z,{data:t.expandedTree.value,itemHeight:a.value},{default:({item:e})=>i(e)})]):t.expandedTree.value.map(e=>i(e))])}}}),ee={install(o){o.component(L.name,L)}};C.Tree=L,C.default=ee,Object.defineProperties(C,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
