(function(V,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(V=typeof globalThis<"u"?globalThis:V||self,n(V.index={},V.Vue))})(this,function(V,n){"use strict";function D(r,e=0,d=[]){return e++,r.reduce((c,t)=>{const l={...t};l.level=e,d.length>0&&d[d.length-1].level>=e&&d.pop(),d.push(l);const s=d[d.length-2];if(s&&(l.parentId=s.id),l.children){const o=D(l.children,e,d);return delete l.children,c.concat(l,o)}else return l.isLeaf===void 0&&(l.isLeaf=!0),c.concat(l)},[])}function w(r,{getChildren:e}){return{toggleCheckNode:c=>{c.checked=!c.checked,e(c).forEach(o=>{o.checked=c.checked});const t=r.value.find(o=>o.id===c.parentId);if(!t)return;const l=e(t,!1),s=l.filter(o=>o.checked);s.length===l.length?t.checked=!0:s.length===0&&(t.checked=!1)}}}function H(r){const e=n.computed(()=>{let o=[];const a=[];for(const f of r.value)o.map(i=>i.id).includes(f.id)||(f.expanded!==!0&&(o=d(f)),a.push(f));return a}),d=(o,a=!0)=>{const f=[],i=r.value.findIndex(v=>v.id===o.id);for(let v=i+1;v<r.value.length&&o.level<r.value[v].level;v++)(a||o.level===r.value[v].level-1)&&f.push(r.value[v]);return f},c=(o,a=[])=>{const f=d(o,!1);return a.push(...f),f.forEach(i=>{i.expanded&&c(i,a)}),a};return{expandedTree:e,getChildren:d,getChildrenExpanded:c,getIndex:o=>o?r.value.findIndex(a=>a.id===o.id):-1,getNode:o=>r.value.find(a=>a.id===o.id),getParent:o=>r.value.find(a=>a.id===o.parentId)}}const C={dropPrev:"s-tree__node--drop-prev",dropNext:"s-tree__node--drop-next",dropInner:"s-tree__node--drop-inner"};function z(r,e,{getChildren:d,getParent:c}){const t=n.reactive({dropType:void 0,draggingNode:null,draggingTreeNode:null}),l=n.computed(()=>e.value.reduce((u,p)=>({...u,[p.id]:p}),{})),s=u=>{u==null||u.classList.remove(...Object.values(C))},o=(u,p)=>{var h;const g=(h=l.value[u])==null?void 0:h.parentId;return g===p?!0:g!==void 0?o(g,p):!1},a=()=>{t.dropType=void 0,t.draggingNode=null,t.draggingTreeNode=null},f=(u,p)=>{var g;u.stopPropagation(),t.draggingNode=u.target,t.draggingTreeNode=p,(g=u.dataTransfer)==null||g.setData("dragNodeId",p.id)},i=u=>{if(u.preventDefault(),u.stopPropagation(),!!t.draggingNode&&r){if(u.dataTransfer&&(u.dataTransfer.dropEffect="move"),!e)return;let p={};typeof r=="object"?p=r:r===!0&&(p={dropInner:!0});const{dropPrev:g,dropNext:h,dropInner:N}=p;let x;const y=g?N?.25:h?.45:1:-1,b=h?N?.75:g?.55:0:1,T=u.currentTarget,L=T==null?void 0:T.getBoundingClientRect(),E=u.clientY-((L==null?void 0:L.top)||0);if(E<((L==null?void 0:L.height)||0)*y?x="dropPrev":E>((L==null?void 0:L.height)||0)*b?x="dropNext":N?x="dropInner":x=void 0,x){const P=T==null?void 0:T.classList;P&&(P.contains(C[x])||(s(T),P.add(C[x])))}else s(T);t.dropType=x}},v=u=>{u.stopPropagation(),t.draggingNode&&s(u.currentTarget)},m=(u,p)=>{var h;if(u.preventDefault(),u.stopPropagation(),s(u.currentTarget),!t.draggingNode||!r)return;const g=(h=u.dataTransfer)==null?void 0:h.getData("dragNodeId");if(g){const N=o(p.id,g);if(g===p.id||N)return;t.dropType&&I(g,p),a()}};function I(u,p){const g=e.value.find(h=>h.id===u);if(g){let h;const N=d(g),x=c(g);if(t.dropType==="dropInner"){h={...g,parentId:p.id,level:p.level+1};const y=e.value.indexOf(p);e.value.splice(y+1,0,h),p.isLeaf=void 0;const b=e.value.indexOf(g);e.value.splice(b,1)}else if(t.dropType==="dropNext"){h={...g,parentId:p.parentId,level:p.level};const y=e.value.indexOf(p),b=d(p,!0).length;e.value.splice(y+b+1,0,h);const T=e.value.indexOf(g);e.value.splice(T,1)}else if(t.dropType==="dropPrev"){h={...g,parentId:p.parentId,level:p.level};const y=e.value.indexOf(p);e.value.splice(y,0,h);const b=e.value.indexOf(g);e.value.splice(b,1)}t.dropType="dropInner",N.forEach(y=>I(y.id,h)),x&&d(x).length===0&&(x.isLeaf=!0)}}return{onDragstart:f,onDragover:i,onDragleave:v,onDrop:m,onDragend:u=>{u.preventDefault(),u.stopPropagation(),a()}}}function j(r,{getNode:e,getIndex:d,getChildren:c},{emit:t}){const l=f=>{const i=e(f);i&&i.isLeaf===!1&&!i.childNodeCount&&(i.loading=!0,t("lazy-load",f,s))},s=f=>{const i=e(f.node);if(i){i.loading=!1;const v=n.ref(D(f.treeItems,i.level));o(i,v),a(i,v);const m=c(i);i.childNodeCount=m.length}},o=(f,i)=>{i.value.forEach(v=>{v.level-1===f.level&&!v.parentId&&(v.parentId=f.id)})},a=(f,i)=>{const v=d(f);v&&r.value.splice(v+1,0,...i.value)};return{lazyLoadNodes:l}}function B(r=8){const e="abcdefghijklmnopqrstuvwxyz0123456789";let d="";for(let c=0;c<r;c++)d+=e[parseInt((Math.random()*e.length).toString())];return d}function R(r,{getChildren:e,getIndex:d}){return{append:(l,s)=>{const o=e(l,!1),a=o[o.length-1];let f=d(l)+1;a&&(f=d(a)+1),l.expanded=!0,l.isLeaf=!1;const i=n.ref({...s,level:l.level+1,parentId:l.id,isLeaf:!0});i.value.id===void 0&&(i.value.id=B()),r.value.splice(f,0,i.value)},remove:l=>{const s=e(l).map(o=>o.id);r.value=r.value.filter(o=>o.id!==l.id&&!s.includes(o.id))}}}function $(r,e,d,c){const{lazyLoadNodes:t}=c;return{toggleNode:s=>{const o=r.value.find(a=>a.id===s.id);o&&(o.expanded=!o.expanded,o.expanded&&t(o))}}}function q(r,e,d){const c=n.unref(r),t=n.ref(D(c)),l=H(t),s=[$,w,R],o=j(t,l,d),a=z(e.draggable,t,l);return{...s.reduce((i,v)=>({...i,...v(t,l,d,o)}),{}),...l,...a,treeData:t}}const M={data:{type:Object,required:!0},lineable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1},draggable:{type:[Boolean,Object],default:!1},height:{type:Number},itemHeight:{type:Number,default:30}},U={...M,treeNode:{type:Object,required:!0}},O=32,S=24,Y=n.defineComponent({name:"STreeNode",props:U,setup(r,{slots:e}){const{lineable:d,checkable:c,treeNode:t,operable:l,draggable:s}=n.toRefs(r),{toggleCheckNode:o,getChildrenExpanded:a,append:f,remove:i,onDragend:v,onDragleave:m,onDragover:I,onDragstart:k,onDrop:u}=n.inject("TREE_UTILS"),p=n.ref(!1),g=()=>{p.value?p.value=!1:p.value=!0};let h={};return s.value&&(h={draggable:!0,onDragend:N=>v(N),onDragleave:N=>m(N),onDragover:N=>I(N),onDragstart:N=>k(N,t.value),onDrop:N=>u(N,t.value)}),()=>{var N,x,y;return n.createVNode("div",{class:"s-tree__node hover:bg-slate-300 relative leading-8",style:{paddingLeft:`${S*(t.value.level-1)}px`},onMouseenter:g,onMouseleave:g},[!t.value.isLeaf&&t.value.expanded&&d.value&&n.createVNode("span",{class:"s-tree-node__vline absolute w-px bg-slate-300",style:{height:`${O*a(t.value).length}px`,left:`${S*(t.value.level-1)+9}px`,top:`${O}px`}},null),n.createVNode("div",n.mergeProps({class:"s-tree__node--content"},h),[t.value.isLeaf?n.createVNode("span",{style:{display:"inline-block",width:"18px"}},null):(N=e.icon)==null?void 0:N.call(e),c.value&&n.withDirectives(n.createVNode("input",{type:"checkbox","onUpdate:modelValue":b=>t.value.checked=b,onClick:()=>{o(t.value)}},null),[[n.vModelCheckbox,t.value.checked]]),(x=e.content)==null?void 0:x.call(e),l.value&&p.value&&n.createVNode("span",{class:"inline-flex ml-1"},[n.createVNode("svg",{onClick:()=>{f(t.value,{label:"新节点"})},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer"},[n.createVNode("path",{d:"M590.769231 571.076923h324.923077c15.753846 0 29.538462-13.784615 29.538461-29.538461v-59.076924c0-15.753846-13.784615-29.538462-29.538461-29.538461H590.769231c-11.815385 0-19.692308-7.876923-19.692308-19.692308V108.307692c0-15.753846-13.784615-29.538462-29.538461-29.538461h-59.076924c-15.753846 0-29.538462 13.784615-29.538461 29.538461V433.230769c0 11.815385-7.876923 19.692308-19.692308 19.692308H108.307692c-15.753846 0-29.538462 13.784615-29.538461 29.538461v59.076924c0 15.753846 13.784615 29.538462 29.538461 29.538461H433.230769c11.815385 0 19.692308 7.876923 19.692308 19.692308v324.923077c0 15.753846 13.784615 29.538462 29.538461 29.538461h59.076924c15.753846 0 29.538462-13.784615 29.538461-29.538461V590.769231c0-11.815385 7.876923-19.692308 19.692308-19.692308z"},null)]),n.createVNode("svg",{onClick:()=>{i(t.value)},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer ml-1"},[n.createVNode("path",{d:"M610.461538 500.184615l256-257.96923c11.815385-11.815385 11.815385-29.538462 0-41.353847l-39.384615-41.353846c-11.815385-11.815385-29.538462-11.815385-41.353846 0L527.753846 417.476923c-7.876923 7.876923-19.692308 7.876923-27.569231 0L242.215385 157.538462c-11.815385-11.815385-29.538462-11.815385-41.353847 0l-41.353846 41.353846c-11.815385 11.815385-11.815385 29.538462 0 41.353846l257.969231 257.969231c7.876923 7.876923 7.876923 19.692308 0 27.56923L157.538462 785.723077c-11.815385 11.815385-11.815385 29.538462 0 41.353846l41.353846 41.353846c11.815385 11.815385 29.538462 11.815385 41.353846 0L498.215385 610.461538c7.876923-7.876923 19.692308-7.876923 27.56923 0l257.969231 257.969231c11.815385 11.815385 29.538462 11.815385 41.353846 0L866.461538 827.076923c11.815385-11.815385 11.815385-29.538462 0-41.353846L610.461538 527.753846c-7.876923-7.876923-7.876923-19.692308 0-27.569231z"},null)])]),t.value.loading&&((y=e.loading)==null?void 0:y.call(e))])])}}}),A=(r,{emit:e})=>n.createVNode("svg",{style:{width:"18px",height:"18px",display:"inline-block",transform:r.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",onClick:()=>e("onClick")},[n.createVNode("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)]),K="",G={data:{type:Array,default:[]},itemHeight:{type:Number,default:22},component:{type:String,default:"div"}},Q="",F=n.defineComponent({name:"SVirtualList",props:G,setup(r,{slots:e}){const{data:d,itemHeight:c,component:t}=n.toRefs(r),l=n.ref(),s=n.ref(0),o=n.ref(0),a=n.ref(0),f=n.computed(()=>Math.ceil(s.value/c.value)),i=n.computed(()=>d.value.slice(a.value,Math.min(a.value+f.value,d.value.length)));n.onMounted(()=>{var m;s.value=(m=l.value)==null?void 0:m.clientHeight});const v=m=>{const{scrollTop:I}=m.target;a.value=Math.floor(I/c.value),o.value=I-I%c.value};return()=>n.createVNode(t.value,{class:"s-virtual-list__container",ref:l,onScroll:v},{default:()=>[n.createVNode("div",{class:"s-virtual-list__blank",style:{height:`${d.value.length*c.value}px`}},null),n.createVNode("div",{class:"s-virtual-list",style:{transform:`translate3d(0, ${o.value}px, 0)`}},[i.value.map((m,I)=>{var k;return(k=e.default)==null?void 0:k.call(e,{item:m,index:I})})])]})}}),_=n.defineComponent({name:"STree",props:M,emits:["lazy-load"],setup(r,e){const{data:d,height:c,itemHeight:t}=n.toRefs(r),{slots:l}=e,s=q(d,r,e);return n.provide("TREE_UTILS",s),()=>{const o=a=>n.createVNode(Y,n.mergeProps(r,{treeNode:a}),{content:()=>l.content?l.content(a):a.label,icon:()=>l.icon?l.icon({nodeData:a,toggleNode:s.toggleNode}):n.createVNode(A,{expanded:!!a.expanded,onClick:()=>s.toggleNode(a)},null),loading:()=>l.loading?l.loading({nodeData:s}):n.createVNode("span",{class:"ml-1"},[n.createTextVNode("loading...")])});return n.createVNode("div",{class:"s-tree"},[c!=null&&c.value?n.createVNode("div",{style:{height:`${c.value}px`}},[n.createVNode(F,{data:s.expandedTree.value,itemHeight:t.value},{default:({item:a})=>o(a)})]):s.expandedTree.value.map(a=>o(a))])}}}),J={install(r){r.component(_.name,_)}};V.Tree=_,V.default=J,Object.defineProperties(V,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
