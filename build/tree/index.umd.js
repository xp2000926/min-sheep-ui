(function(V,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(V=typeof globalThis<"u"?globalThis:V||self,n(V.index={},V.Vue))})(this,function(V,n){"use strict";function _(e,a=0,r=[]){return a++,e.reduce((f,o)=>{const s={...o};s.level=a,r.length>0&&r[r.length-1].level>=a&&r.pop(),r.push(s);const i=r[r.length-2];if(i&&(s.parentId=i.id),s.children){const t=_(s.children,a,r);return delete s.children,f.concat(s,t)}else return s.isLeaf===void 0&&(s.isLeaf=!0),f.concat(s)},[])}function j(e,{getChildren:a,getParent:r},{emit:f}){const o=i=>{i.checked=!i.checked,a(i).forEach(c=>{c.checked=i.checked,c.inChecked=a(i,!0).every(x=>x.inChecked)}),i.inChecked=!1,s(i);const t=e.value.map(c=>{if(c.checked)return c.id}).filter(Boolean),u=e.value.map(c=>{if(c.checked)return c}).filter(Boolean),l=e.value.map(c=>{if(c.inChecked)return c.id}).filter(Boolean),d=e.value.map(c=>{if(c.inChecked)return c}).filter(Boolean);f("check",i,t,u,l,d)},s=i=>{const t=r(i);if(!t)return;const u=a(t,!0),l=u.every(c=>c.checked);t.checked=l;const d=u.some(c=>c.checked);l?t.inChecked=!1:d?t.inChecked=!0:t.inChecked=!1,t.parentId&&s(t)};return{toggleCheckNode:o}}function H(e){const a=n.computed(()=>{let t=[];const u=[];for(const l of e.value)t.map(d=>d.id).includes(l.id)||(l.expanded!==!0&&(t=r(l)),u.push(l));return u}),r=(t,u=!0)=>{const l=[],d=e.value.findIndex(c=>c.id===t.id);for(let c=d+1;c<e.value.length&&t.level<e.value[c].level;c++)(u||t.level===e.value[c].level-1)&&l.push(e.value[c]);return l},f=(t,u=[])=>{const l=r(t,!1);return u.push(...l),l.forEach(d=>{d.expanded&&f(d,u)}),u};return{expandedTree:a,getChildren:r,getChildrenExpanded:f,getIndex:t=>t?e.value.findIndex(u=>u.id===t.id):-1,getNode:t=>e.value.find(u=>u.id===t.id),getParent:t=>e.value.find(u=>u.id===t.parentId)}}const L={dropPrev:"s-tree__node--drop-prev",dropNext:"s-tree__node--drop-next",dropInner:"s-tree__node--drop-inner"};function z(e,a,{getChildren:r,getParent:f}){const o=n.reactive({dropType:void 0,draggingNode:null,draggingTreeNode:null}),s=n.computed(()=>a.value.reduce((p,g)=>({...p,[g.id]:g}),{})),i=p=>{p==null||p.classList.remove(...Object.values(L))},t=(p,g)=>{var b;const h=(b=s.value[p])==null?void 0:b.parentId;return h===g?!0:h!==void 0?t(h,g):!1},u=()=>{o.dropType=void 0,o.draggingNode=null,o.draggingTreeNode=null},l=(p,g)=>{var h;p.stopPropagation(),o.draggingNode=p.target,o.draggingTreeNode=g,(h=p.dataTransfer)==null||h.setData("dragNodeId",g.id)},d=p=>{if(p.preventDefault(),p.stopPropagation(),!!o.draggingNode&&e){if(p.dataTransfer&&(p.dataTransfer.dropEffect="move"),!a)return;let g={};typeof e=="object"?g=e:e===!0&&(g={dropInner:!0});const{dropPrev:h,dropNext:b,dropInner:C}=g;let v;const N=h?C?.25:b?.45:1:-1,y=b?C?.75:h?.55:0:1,k=p.currentTarget,I=k==null?void 0:k.getBoundingClientRect(),M=p.clientY-((I==null?void 0:I.top)||0);if(M<((I==null?void 0:I.height)||0)*N?v="dropPrev":M>((I==null?void 0:I.height)||0)*y?v="dropNext":C?v="dropInner":v=void 0,v){const w=k==null?void 0:k.classList;w&&(w.contains(L[v])||(i(k),w.add(L[v])))}else i(k);o.dropType=v}},c=p=>{p.stopPropagation(),o.draggingNode&&i(p.currentTarget)},x=(p,g)=>{var b;if(p.preventDefault(),p.stopPropagation(),i(p.currentTarget),!o.draggingNode||!e)return;const h=(b=p.dataTransfer)==null?void 0:b.getData("dragNodeId");if(h){const C=t(g.id,h);if(h===g.id||C)return;o.dropType&&m(h,g),u()}};function m(p,g){const h=a.value.find(b=>b.id===p);if(h){let b;const C=r(h),v=f(h);if(o.dropType==="dropInner"){b={...h,parentId:g.id,level:g.level+1};const N=a.value.indexOf(g);a.value.splice(N+1,0,b),g.isLeaf=void 0;const y=a.value.indexOf(h);a.value.splice(y,1)}else if(o.dropType==="dropNext"){b={...h,parentId:g.parentId,level:g.level};const N=a.value.indexOf(g),y=r(g,!0).length;a.value.splice(N+y+1,0,b);const k=a.value.indexOf(h);a.value.splice(k,1)}else if(o.dropType==="dropPrev"){b={...h,parentId:g.parentId,level:g.level};const N=a.value.indexOf(g);a.value.splice(N,0,b);const y=a.value.indexOf(h);a.value.splice(y,1)}o.dropType="dropInner",C.forEach(N=>m(N.id,b)),v&&r(v).length===0&&(v.isLeaf=!0)}}return{onDragstart:l,onDragover:d,onDragleave:c,onDrop:x,onDragend:p=>{p.preventDefault(),p.stopPropagation(),u()}}}function $(e,{getNode:a,getIndex:r,getChildren:f},{emit:o}){const s=l=>{const d=a(l);d&&d.isLeaf===!1&&!d.childNodeCount&&(d.loading=!0,o("lazy-load",l,i))},i=l=>{const d=a(l.node);if(d){d.loading=!1;const c=n.ref(_(l.treeItems,d.level));t(d,c),u(d,c);const x=f(d);d.childNodeCount=x.length}},t=(l,d)=>{d.value.forEach(c=>{c.level-1===l.level&&!c.parentId&&(c.parentId=l.id)})},u=(l,d)=>{const c=r(l);c&&e.value.splice(c+1,0,...d.value)};return{lazyLoadNodes:s}}function A(e=8){const a="abcdefghijklmnopqrstuvwxyz0123456789";let r="";for(let f=0;f<e;f++)r+=a[parseInt((Math.random()*a.length).toString())];return r}function q(e,{getChildren:a,getIndex:r}){return{append:(s,i)=>{const t=a(s,!1),u=t[t.length-1];let l=r(s)+1;u&&(l=r(u)+1),s.expanded=!0,s.isLeaf=!1;const d=n.ref({...i,level:s.level+1,parentId:s.id,isLeaf:!0});d.value.id===void 0&&(d.value.id=A()),e.value.splice(l,0,d.value)},remove:s=>{const i=a(s).map(t=>t.id);e.value=e.value.filter(t=>t.id!==s.id&&!i.includes(t.id))}}}function F(e,a,r,f){const{lazyLoadNodes:o}=f;return{toggleNode:(i,t,u=!1)=>{if(i.stopPropagation(),u)e.value.forEach(l=>{l.level<=t.level?(l.level===t.level&&l.id!==t.id&&(l.expanded=!1),l.id===t.id&&(l.expanded=!l.expanded),l.expanded&&o(l)):l.expanded=!1});else{const l=e.value.find(d=>d.id===t.id);l&&(l.expanded=!l.expanded,l.expanded&&o(l))}}}}function K(e,a,r){const f=n.unref(e),o=n.ref(_(f)),s=H(o),i=[F,j,q],t=$(o,s,r),u=z(a.draggable,o,s);return{...i.reduce((d,c)=>({...d,...c(o,s,r,t)}),{}),...s,...u,treeData:o}}const O={data:{type:Object,required:!0},lineable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1},draggable:{type:[Boolean,Object],default:!1},height:{type:Number},itemHeight:{type:Number,default:30},accordion:{type:Boolean,default:!1}},B={onClick:{type:Function,required:!0},disabled:{type:Boolean,default:!1},marginRight:{type:Number,default:8}},te="",le="";var D={},U={get exports(){return D},set exports(e){D=e}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(e){(function(){var a={}.hasOwnProperty;function r(){for(var f=[],o=0;o<arguments.length;o++){var s=arguments[o];if(s){var i=typeof s;if(i==="string"||i==="number")f.push(s);else if(Array.isArray(s)){if(s.length){var t=r.apply(null,s);t&&f.push(t)}}else if(i==="object"){if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]")){f.push(s.toString());continue}for(var u in s)a.call(s,u)&&s[u]&&f.push(u)}}}return f.join(" ")}e.exports?(r.default=r,e.exports=r):window.classNames=r})()})(U);const S=D,Y=n.defineComponent({name:"SBaseSelectAll",props:B,setup(e){return()=>n.createVNode("label",{class:S("s-base-select-all","is-checked",{"is-disabled":e.disabled}),style:{marginRight:e.marginRight+"px"}},[n.createVNode("span",{class:S("s-base-select-all__input","is-checked",{"is-disabled":e.disabled})},[n.createVNode("span",{class:"s-base-select-all__inner"},null),n.createVNode("input",{type:"checkbox",disabled:e.disabled,"aria-hidden":"false",class:"s-base-select-all__original",value:"",tabindex:"-1",onClick:()=>{e.onClick()}},null)])])}}),ae="",G=n.defineComponent({name:"SBaseSelectionBox",props:B,setup(e){return()=>n.createVNode("label",{class:S("s-base-selection-box",{"is-disabled":e.disabled}),style:{marginRight:e.marginRight+"px"}},[n.createVNode("span",{class:S("s-base-selection-box__input",{"is-disabled":e.disabled})},[n.createVNode("span",{class:"s-base-selection-box__inner"},null),n.createVNode("input",{type:"checkbox",disabled:e.disabled,"aria-hidden":"false",class:"s-base-selection-box__original",value:"",tabindex:"-1",onClick:()=>{e.onClick()}},null)])])}}),oe="",J=n.defineComponent({name:"SBaseSemiSelection",props:B,setup(e){return()=>n.createVNode("label",{class:S("s-base-semi-selection",{"is-disabled":e.disabled}),style:{marginRight:e.marginRight+"px"}},[n.createVNode("span",{class:S("s-base-semi-selection__input","is-indeterminate",{"is-disabled":e.disabled}),tabindex:"0",role:"checkbox","aria-checked":"mixed"},[n.createVNode("span",{class:"s-base-semi-selection__inner"},null),n.createVNode("input",{type:"checkbox","aria-hidden":"true",disabled:e.disabled,class:"s-base-semi-selection__original",value:"",tabindex:"-1",onClick:()=>{e.onClick()}},null)])])}}),Q={...O,treeNode:{type:Object,required:!0}},E=34,R=24,W=n.defineComponent({name:"STreeNode",props:Q,setup(e,{slots:a}){const{lineable:r,checkable:f,treeNode:o,operable:s,draggable:i}=n.toRefs(e),{toggleCheckNode:t,getChildrenExpanded:u,append:l,remove:d,onDragend:c,onDragleave:x,onDragover:m,onDragstart:T,onDrop:p}=n.inject("TREE_UTILS"),g=n.ref(!1),h=()=>{g.value?g.value=!1:g.value=!0};let b={};i.value&&(b={draggable:!0,onDragend:v=>c(v),onDragleave:v=>x(v),onDragover:v=>m(v),onDragstart:v=>T(v,o.value),onDrop:v=>p(v,o.value)});const C=()=>n.createVNode(n.Fragment,null,[o.value.inChecked?n.createVNode(J,{onClick:()=>t(o.value),disabled:o.value.disabled},null):o.value.checked?n.createVNode(Y,{onClick:()=>t(o.value),disabled:o.value.disabled},null):n.createVNode(G,{onClick:()=>t(o.value),disabled:o.value.disabled},null)]);return()=>{var v,N,y;return n.createVNode("div",{class:"s-tree__node hover:bg-slate-300 relative leading-8",style:{paddingLeft:`${R*(o.value.level-1)}px`},onMouseenter:h,onMouseleave:h},[!o.value.isLeaf&&o.value.expanded&&r.value&&n.createVNode("span",{class:"s-tree-node__vline absolute w-px bg-slate-300",style:{height:`${E*u(o.value).length}px`,left:`${R*(o.value.level-1)+9}px`,top:`${E}px`}},null),n.createVNode("div",n.mergeProps({class:"s-tree__node--content"},b),[o.value.isLeaf?n.createVNode("span",{style:{display:"inline-block",width:"18px"}},null):(v=a.icon)==null?void 0:v.call(a),f.value&&C(),(N=a.content)==null?void 0:N.call(a),s.value&&g.value&&n.createVNode("span",{class:"inline-flex ml-1"},[n.createVNode("svg",{onClick:()=>{l(o.value,{label:"新节点"})},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer"},[n.createVNode("path",{d:"M590.769231 571.076923h324.923077c15.753846 0 29.538462-13.784615 29.538461-29.538461v-59.076924c0-15.753846-13.784615-29.538462-29.538461-29.538461H590.769231c-11.815385 0-19.692308-7.876923-19.692308-19.692308V108.307692c0-15.753846-13.784615-29.538462-29.538461-29.538461h-59.076924c-15.753846 0-29.538462 13.784615-29.538461 29.538461V433.230769c0 11.815385-7.876923 19.692308-19.692308 19.692308H108.307692c-15.753846 0-29.538462 13.784615-29.538461 29.538461v59.076924c0 15.753846 13.784615 29.538462 29.538461 29.538461H433.230769c11.815385 0 19.692308 7.876923 19.692308 19.692308v324.923077c0 15.753846 13.784615 29.538462 29.538461 29.538461h59.076924c15.753846 0 29.538462-13.784615 29.538461-29.538461V590.769231c0-11.815385 7.876923-19.692308 19.692308-19.692308z"},null)]),n.createVNode("svg",{onClick:()=>{d(o.value)},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer ml-1"},[n.createVNode("path",{d:"M610.461538 500.184615l256-257.96923c11.815385-11.815385 11.815385-29.538462 0-41.353847l-39.384615-41.353846c-11.815385-11.815385-29.538462-11.815385-41.353846 0L527.753846 417.476923c-7.876923 7.876923-19.692308 7.876923-27.569231 0L242.215385 157.538462c-11.815385-11.815385-29.538462-11.815385-41.353847 0l-41.353846 41.353846c-11.815385 11.815385-11.815385 29.538462 0 41.353846l257.969231 257.969231c7.876923 7.876923 7.876923 19.692308 0 27.56923L157.538462 785.723077c-11.815385 11.815385-11.815385 29.538462 0 41.353846l41.353846 41.353846c11.815385 11.815385 29.538462 11.815385 41.353846 0L498.215385 610.461538c7.876923-7.876923 19.692308-7.876923 27.56923 0l257.969231 257.969231c11.815385 11.815385 29.538462 11.815385 41.353846 0L866.461538 827.076923c11.815385-11.815385 11.815385-29.538462 0-41.353846L610.461538 527.753846c-7.876923-7.876923-7.876923-19.692308 0-27.569231z"},null)])]),o.value.loading&&((y=a.loading)==null?void 0:y.call(a))])])}}}),X=(e,{emit:a})=>n.createVNode("svg",{style:{width:"18px",height:"18px",display:"inline-block",transform:e.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",onClick:()=>a("onClick")},[n.createVNode("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)]),se="",Z={data:{type:Array,default:[]},itemHeight:{type:Number,default:22},component:{type:String,default:"div"}},ie="",ee=n.defineComponent({name:"SVirtualList",props:Z,setup(e,{slots:a}){const{data:r,itemHeight:f,component:o}=n.toRefs(e),s=n.ref(),i=n.ref(0),t=n.ref(0),u=n.ref(0),l=n.computed(()=>Math.ceil(i.value/f.value)),d=n.computed(()=>r.value.slice(u.value,Math.min(u.value+l.value,r.value.length)));n.onMounted(()=>{var x;i.value=(x=s.value)==null?void 0:x.clientHeight});const c=x=>{const{scrollTop:m}=x.target;u.value=Math.floor(m/f.value),t.value=m-m%f.value};return()=>n.createVNode(o.value,{class:"s-virtual-list__container",ref:s,onScroll:c},{default:()=>[n.createVNode("div",{class:"s-virtual-list__blank",style:{height:`${r.value.length*f.value}px`}},null),n.createVNode("div",{class:"s-virtual-list",style:{transform:`translate3d(0, ${t.value}px, 0)`}},[d.value.map((x,m)=>{var T;return(T=a.default)==null?void 0:T.call(a,{item:x,index:m})})])]})}}),P=n.defineComponent({name:"STree",props:O,emits:["lazy-load","check"],setup(e,a){const{data:r,height:f,itemHeight:o,accordion:s}=n.toRefs(e),{slots:i}=a,t=K(r,e,a);return n.provide("TREE_UTILS",t),()=>{const u=l=>n.createVNode(W,n.mergeProps(e,{treeNode:l,onClick:s.value?d=>t.toggleNode(d,l,s.value):""}),{content:()=>i.content?i.content(l):l.label,icon:()=>i.icon?i.icon({nodeData:l,toggleNode:t.toggleNode}):n.createVNode(X,{expanded:!!l.expanded,onClick:d=>t.toggleNode(d,l,s.value)},null),loading:()=>i.loading?i.loading({nodeData:t}):n.createVNode("span",{class:"ml-1"},[n.createTextVNode("loading...")])});return n.createVNode("div",{class:"s-tree"},[f!=null&&f.value?n.createVNode("div",{style:{height:`${f.value}px`}},[n.createVNode(ee,{data:t.expandedTree.value,itemHeight:o.value},{default:({item:l})=>u(l)})]):t.expandedTree.value.map(l=>u(l))])}}}),ne={install(e){e.component(P.name,P)}};V.Tree=P,V.default=ne,Object.defineProperties(V,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
