(function(V,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(V=typeof globalThis<"u"?globalThis:V||self,e(V.index={},V.Vue))})(this,function(V,e){"use strict";function _(a,t=0,d=[]){return t++,a.reduce((f,o)=>{const r={...o};r.level=t,d.length>0&&d[d.length-1].level>=t&&d.pop(),d.push(r);const c=d[d.length-2];if(c&&(r.parentId=c.id),r.children){const l=_(r.children,t,d);return delete r.children,f.concat(r,l)}else return r.isLeaf===void 0&&(r.isLeaf=!0),f.concat(r)},[])}function w(a,{getChildren:t,getParent:d}){const f=r=>{r.checked=!r.checked,r.inChecked=!1,t(r).forEach(c=>{c.checked=r.checked}),o(r)},o=r=>{const c=d(r);if(!c)return;const l=t(c,!0),i=l.every(s=>s.checked);c.checked=i;const n=l.some(s=>s.checked);i?c.inChecked=!1:n?c.inChecked=!0:c.inChecked=!1,c.parentId&&o(c)};return{toggleCheckNode:f}}function H(a){const t=e.computed(()=>{let l=[];const i=[];for(const n of a.value)l.map(s=>s.id).includes(n.id)||(n.expanded!==!0&&(l=d(n)),i.push(n));return i}),d=(l,i=!0)=>{const n=[],s=a.value.findIndex(h=>h.id===l.id);for(let h=s+1;h<a.value.length&&l.level<a.value[h].level;h++)(i||l.level===a.value[h].level-1)&&n.push(a.value[h]);return n},f=(l,i=[])=>{const n=d(l,!1);return i.push(...n),n.forEach(s=>{s.expanded&&f(s,i)}),i};return{expandedTree:t,getChildren:d,getChildrenExpanded:f,getIndex:l=>l?a.value.findIndex(i=>i.id===l.id):-1,getNode:l=>a.value.find(i=>i.id===l.id),getParent:l=>a.value.find(i=>i.id===l.parentId)}}const S={dropPrev:"s-tree__node--drop-prev",dropNext:"s-tree__node--drop-next",dropInner:"s-tree__node--drop-inner"};function z(a,t,{getChildren:d,getParent:f}){const o=e.reactive({dropType:void 0,draggingNode:null,draggingTreeNode:null}),r=e.computed(()=>t.value.reduce((u,p)=>({...u,[p.id]:p}),{})),c=u=>{u==null||u.classList.remove(...Object.values(S))},l=(u,p)=>{var v;const g=(v=r.value[u])==null?void 0:v.parentId;return g===p?!0:g!==void 0?l(g,p):!1},i=()=>{o.dropType=void 0,o.draggingNode=null,o.draggingTreeNode=null},n=(u,p)=>{var g;u.stopPropagation(),o.draggingNode=u.target,o.draggingTreeNode=p,(g=u.dataTransfer)==null||g.setData("dragNodeId",p.id)},s=u=>{if(u.preventDefault(),u.stopPropagation(),!!o.draggingNode&&a){if(u.dataTransfer&&(u.dataTransfer.dropEffect="move"),!t)return;let p={};typeof a=="object"?p=a:a===!0&&(p={dropInner:!0});const{dropPrev:g,dropNext:v,dropInner:x}=p;let N;const m=g?x?.25:v?.45:1:-1,T=v?x?.75:g?.55:0:1,k=u.currentTarget,I=k==null?void 0:k.getBoundingClientRect(),M=u.clientY-((I==null?void 0:I.top)||0);if(M<((I==null?void 0:I.height)||0)*m?N="dropPrev":M>((I==null?void 0:I.height)||0)*T?N="dropNext":x?N="dropInner":N=void 0,N){const P=k==null?void 0:k.classList;P&&(P.contains(S[N])||(c(k),P.add(S[N])))}else c(k);o.dropType=N}},h=u=>{u.stopPropagation(),o.draggingNode&&c(u.currentTarget)},b=(u,p)=>{var v;if(u.preventDefault(),u.stopPropagation(),c(u.currentTarget),!o.draggingNode||!a)return;const g=(v=u.dataTransfer)==null?void 0:v.getData("dragNodeId");if(g){const x=l(p.id,g);if(g===p.id||x)return;o.dropType&&y(g,p),i()}};function y(u,p){const g=t.value.find(v=>v.id===u);if(g){let v;const x=d(g),N=f(g);if(o.dropType==="dropInner"){v={...g,parentId:p.id,level:p.level+1};const m=t.value.indexOf(p);t.value.splice(m+1,0,v),p.isLeaf=void 0;const T=t.value.indexOf(g);t.value.splice(T,1)}else if(o.dropType==="dropNext"){v={...g,parentId:p.parentId,level:p.level};const m=t.value.indexOf(p),T=d(p,!0).length;t.value.splice(m+T+1,0,v);const k=t.value.indexOf(g);t.value.splice(k,1)}else if(o.dropType==="dropPrev"){v={...g,parentId:p.parentId,level:p.level};const m=t.value.indexOf(p);t.value.splice(m,0,v);const T=t.value.indexOf(g);t.value.splice(T,1)}o.dropType="dropInner",x.forEach(m=>y(m.id,v)),N&&d(N).length===0&&(N.isLeaf=!0)}}return{onDragstart:n,onDragover:s,onDragleave:h,onDrop:b,onDragend:u=>{u.preventDefault(),u.stopPropagation(),i()}}}function j(a,{getNode:t,getIndex:d,getChildren:f},{emit:o}){const r=n=>{const s=t(n);s&&s.isLeaf===!1&&!s.childNodeCount&&(s.loading=!0,o("lazy-load",n,c))},c=n=>{const s=t(n.node);if(s){s.loading=!1;const h=e.ref(_(n.treeItems,s.level));l(s,h),i(s,h);const b=f(s);s.childNodeCount=b.length}},l=(n,s)=>{s.value.forEach(h=>{h.level-1===n.level&&!h.parentId&&(h.parentId=n.id)})},i=(n,s)=>{const h=d(n);h&&a.value.splice(h+1,0,...s.value)};return{lazyLoadNodes:r}}function $(a=8){const t="abcdefghijklmnopqrstuvwxyz0123456789";let d="";for(let f=0;f<a;f++)d+=t[parseInt((Math.random()*t.length).toString())];return d}function R(a,{getChildren:t,getIndex:d}){return{append:(r,c)=>{const l=t(r,!1),i=l[l.length-1];let n=d(r)+1;i&&(n=d(i)+1),r.expanded=!0,r.isLeaf=!1;const s=e.ref({...c,level:r.level+1,parentId:r.id,isLeaf:!0});s.value.id===void 0&&(s.value.id=$()),a.value.splice(n,0,s.value)},remove:r=>{const c=t(r).map(l=>l.id);a.value=a.value.filter(l=>l.id!==r.id&&!c.includes(l.id))}}}function q(a,t,d,f){const{lazyLoadNodes:o}=f;return{toggleNode:(c,l,i=!1)=>{if(c.stopPropagation(),i)a.value.forEach(n=>{n.level<=l.level?(n.level===l.level&&n.id!==l.id&&(n.expanded=!1),n.id===l.id&&(n.expanded=!n.expanded),n.expanded&&o(n)):n.expanded=!1});else{const n=a.value.find(s=>s.id===l.id);n&&(n.expanded=!n.expanded,n.expanded&&o(n))}}}}function A(a,t,d){const f=e.unref(a),o=e.ref(_(f)),r=H(o),c=[q,w,R],l=j(o,r,d),i=z(t.draggable,o,r);return{...c.reduce((s,h)=>({...s,...h(o,r,d,l)}),{}),...r,...i,treeData:o}}const B={data:{type:Object,required:!0},lineable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1},draggable:{type:[Boolean,Object],default:!1},height:{type:Number},itemHeight:{type:Number,default:30},accordion:{type:Boolean,default:!1}},L={onClick:{type:Function,required:!0}},Z="",ee="",F=e.defineComponent({name:"SBaseSelectAll",props:L,setup(a){return()=>e.createVNode("label",{class:"s-base-select-all is-checked"},[e.createVNode("span",{class:"s-base-select-all__input is-checked"},[e.createVNode("span",{class:"s-base-select-all__inner"},null),e.createVNode("input",{type:"checkbox","aria-hidden":"false",class:"s-base-select-all__original",value:"",tabindex:"-1",onClick:()=>{a.onClick()}},null)])])}}),ne="",U=e.defineComponent({name:"SBaseSelectionBox",props:L,setup(a){return()=>e.createVNode("label",{class:"s-base-selection-box"},[e.createVNode("span",{class:"s-base-selection-box__input"},[e.createVNode("span",{class:"s-base-selection-box__inner"},null),e.createVNode("input",{type:"checkbox","aria-hidden":"false",class:"s-base-selection-box__original",value:"",tabindex:"-1",onClick:()=>{a.onClick()}},null)])])}}),te="",Y=e.defineComponent({name:"SBaseSemiSelection",props:L,setup(a){return()=>e.createVNode("label",{class:"s-base-semi-selection","aria-controls":"undefined"},[e.createVNode("span",{class:"s-base-semi-selection__input is-indeterminate",tabindex:"0",role:"checkbox","aria-checked":"mixed"},[e.createVNode("span",{class:"s-base-semi-selection__inner"},null),e.createVNode("input",{type:"checkbox","aria-hidden":"true",class:"s-base-semi-selection__original",value:"",tabindex:"-1",onClick:()=>{a.onClick()}},null)])])}}),G={...B,treeNode:{type:Object,required:!0}},E=34,O=24,J=e.defineComponent({name:"STreeNode",props:G,setup(a,{slots:t}){const{lineable:d,checkable:f,treeNode:o,operable:r,draggable:c}=e.toRefs(a),{toggleCheckNode:l,getChildrenExpanded:i,append:n,remove:s,onDragend:h,onDragleave:b,onDragover:y,onDragstart:C,onDrop:u}=e.inject("TREE_UTILS"),p=e.ref(!1),g=()=>{p.value?p.value=!1:p.value=!0};let v={};return c.value&&(v={draggable:!0,onDragend:x=>h(x),onDragleave:x=>b(x),onDragover:x=>y(x),onDragstart:x=>C(x,o.value),onDrop:x=>u(x,o.value)}),()=>{var x,N,m;return e.createVNode("div",{class:"s-tree__node hover:bg-slate-300 relative leading-8",style:{paddingLeft:`${O*(o.value.level-1)}px`},onMouseenter:g,onMouseleave:g},[!o.value.isLeaf&&o.value.expanded&&d.value&&e.createVNode("span",{class:"s-tree-node__vline absolute w-px bg-slate-300",style:{height:`${E*i(o.value).length}px`,left:`${O*(o.value.level-1)+9}px`,top:`${E}px`}},null),e.createVNode("div",e.mergeProps({class:"s-tree__node--content"},v),[o.value.isLeaf?e.createVNode("span",{style:{display:"inline-block",width:"18px"}},null):(x=t.icon)==null?void 0:x.call(t),f.value&&e.createVNode(e.Fragment,null,[o.value.inChecked?e.createVNode(Y,{onClick:()=>l(o.value)},null):o.value.checked?e.createVNode(F,{onClick:()=>l(o.value)},null):e.createVNode(U,{onClick:()=>l(o.value)},null)]),(N=t.content)==null?void 0:N.call(t),r.value&&p.value&&e.createVNode("span",{class:"inline-flex ml-1"},[e.createVNode("svg",{onClick:()=>{n(o.value,{label:"新节点"})},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer"},[e.createVNode("path",{d:"M590.769231 571.076923h324.923077c15.753846 0 29.538462-13.784615 29.538461-29.538461v-59.076924c0-15.753846-13.784615-29.538462-29.538461-29.538461H590.769231c-11.815385 0-19.692308-7.876923-19.692308-19.692308V108.307692c0-15.753846-13.784615-29.538462-29.538461-29.538461h-59.076924c-15.753846 0-29.538462 13.784615-29.538461 29.538461V433.230769c0 11.815385-7.876923 19.692308-19.692308 19.692308H108.307692c-15.753846 0-29.538462 13.784615-29.538461 29.538461v59.076924c0 15.753846 13.784615 29.538462 29.538461 29.538461H433.230769c11.815385 0 19.692308 7.876923 19.692308 19.692308v324.923077c0 15.753846 13.784615 29.538462 29.538461 29.538461h59.076924c15.753846 0 29.538462-13.784615 29.538461-29.538461V590.769231c0-11.815385 7.876923-19.692308 19.692308-19.692308z"},null)]),e.createVNode("svg",{onClick:()=>{s(o.value)},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer ml-1"},[e.createVNode("path",{d:"M610.461538 500.184615l256-257.96923c11.815385-11.815385 11.815385-29.538462 0-41.353847l-39.384615-41.353846c-11.815385-11.815385-29.538462-11.815385-41.353846 0L527.753846 417.476923c-7.876923 7.876923-19.692308 7.876923-27.569231 0L242.215385 157.538462c-11.815385-11.815385-29.538462-11.815385-41.353847 0l-41.353846 41.353846c-11.815385 11.815385-11.815385 29.538462 0 41.353846l257.969231 257.969231c7.876923 7.876923 7.876923 19.692308 0 27.56923L157.538462 785.723077c-11.815385 11.815385-11.815385 29.538462 0 41.353846l41.353846 41.353846c11.815385 11.815385 29.538462 11.815385 41.353846 0L498.215385 610.461538c7.876923-7.876923 19.692308-7.876923 27.56923 0l257.969231 257.969231c11.815385 11.815385 29.538462 11.815385 41.353846 0L866.461538 827.076923c11.815385-11.815385 11.815385-29.538462 0-41.353846L610.461538 527.753846c-7.876923-7.876923-7.876923-19.692308 0-27.569231z"},null)])]),o.value.loading&&((m=t.loading)==null?void 0:m.call(t))])])}}}),K=(a,{emit:t})=>e.createVNode("svg",{style:{width:"18px",height:"18px",display:"inline-block",transform:a.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",onClick:()=>t("onClick")},[e.createVNode("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)]),le="",Q={data:{type:Array,default:[]},itemHeight:{type:Number,default:22},component:{type:String,default:"div"}},oe="",W=e.defineComponent({name:"SVirtualList",props:Q,setup(a,{slots:t}){const{data:d,itemHeight:f,component:o}=e.toRefs(a),r=e.ref(),c=e.ref(0),l=e.ref(0),i=e.ref(0),n=e.computed(()=>Math.ceil(c.value/f.value)),s=e.computed(()=>d.value.slice(i.value,Math.min(i.value+n.value,d.value.length)));e.onMounted(()=>{var b;c.value=(b=r.value)==null?void 0:b.clientHeight});const h=b=>{const{scrollTop:y}=b.target;i.value=Math.floor(y/f.value),l.value=y-y%f.value};return()=>e.createVNode(o.value,{class:"s-virtual-list__container",ref:r,onScroll:h},{default:()=>[e.createVNode("div",{class:"s-virtual-list__blank",style:{height:`${d.value.length*f.value}px`}},null),e.createVNode("div",{class:"s-virtual-list",style:{transform:`translate3d(0, ${l.value}px, 0)`}},[s.value.map((b,y)=>{var C;return(C=t.default)==null?void 0:C.call(t,{item:b,index:y})})])]})}}),D=e.defineComponent({name:"STree",props:B,emits:["lazy-load"],setup(a,t){const{data:d,height:f,itemHeight:o,accordion:r}=e.toRefs(a),{slots:c}=t,l=A(d,a,t);return e.provide("TREE_UTILS",l),()=>{const i=n=>e.createVNode(J,e.mergeProps(a,{treeNode:n,onClick:r.value?s=>l.toggleNode(s,n,r.value):""}),{content:()=>c.content?c.content(n):n.label,icon:()=>c.icon?c.icon({nodeData:n,toggleNode:l.toggleNode}):e.createVNode(K,{expanded:!!n.expanded,onClick:s=>l.toggleNode(s,n,r.value)},null),loading:()=>c.loading?c.loading({nodeData:l}):e.createVNode("span",{class:"ml-1"},[e.createTextVNode("loading...")])});return e.createVNode("div",{class:"s-tree"},[f!=null&&f.value?e.createVNode("div",{style:{height:`${f.value}px`}},[e.createVNode(W,{data:l.expandedTree.value,itemHeight:o.value},{default:({item:n})=>i(n)})]):l.expandedTree.value.map(n=>i(n))])}}}),X={install(a){a.component(D.name,D)}};V.Tree=D,V.default=X,Object.defineProperties(V,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
